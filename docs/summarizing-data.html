<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 9 Summarizing data | Data Visualization</title>
<meta name="author" content="Andrew Irwin">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.7/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4/tabs.js"></script><script src="libs/bs3compat-0.2.4/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><script src="libs/plotly-binding-4.9.3/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Visualization</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="syllabus.html">Syllabus</a></li>
<li><a class="" href="outline.html">Detailed outline</a></li>
<li><a class="" href="sync.html">Synchronous meeting agendas</a></li>
<li><a class="" href="evaluation.html">Evaluation</a></li>
<li><a class="" href="ch-invitation.html"><span class="header-section-number">1</span> Invitation to Data Visualization</a></li>
<li><a class="" href="ch-tools.html"><span class="header-section-number">2</span> Computer tools</a></li>
<li><a class="" href="setup.html"><span class="header-section-number">3</span> Setting up your computer</a></li>
<li><a class="" href="look-data.html"><span class="header-section-number">4</span> Look at Data</a></li>
<li><a class="" href="first-plot.html"><span class="header-section-number">5</span> Making your first plot</a></li>
<li><a class="" href="vcs.html"><span class="header-section-number">6</span> What is version control software?</a></li>
<li><a class="" href="grammar.html"><span class="header-section-number">7</span> Grammar of Graphics</a></li>
<li><a class="" href="ggplot.html"><span class="header-section-number">8</span> Using the grammar of graphics</a></li>
<li><a class="active" href="summarizing-data.html"><span class="header-section-number">9</span> Summarizing data</a></li>
<li><a class="" href="facets.html"><span class="header-section-number">10</span> Facetted graphs</a></li>
<li><a class="" href="reading-data.html"><span class="header-section-number">11</span> Reading data</a></li>
<li><a class="" href="pivot.html"><span class="header-section-number">12</span> Reshaping data</a></li>
<li><a class="" href="format-tables.html"><span class="header-section-number">13</span> Format tables</a></li>
<li><a class="" href="help.html"><span class="header-section-number">14</span> Getting help and asking questions</a></li>
<li><a class="" href="working-models.html"><span class="header-section-number">15</span> Working with models</a></li>
<li><a class="" href="linear-models.html"><span class="header-section-number">16</span> Linear models</a></li>
<li><a class="" href="smoothing.html"><span class="header-section-number">17</span> GAM and LOESS smoothing</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">18</span> Collaborating with GitHub</a></li>
<li><a class="" href="data-sources.html"><span class="header-section-number">19</span> Finding and accessing data</a></li>
<li><a class="" href="reproduce.html"><span class="header-section-number">20</span> Reproducible reports</a></li>
<li><a class="" href="pca.html"><span class="header-section-number">21</span> Principal component analysis</a></li>
<li><a class="" href="mds.html"><span class="header-section-number">22</span> Multidimensional scaling</a></li>
<li><a class="" href="k-means.html"><span class="header-section-number">23</span> K-means clustering</a></li>
<li><a class="" href="slides.html"><span class="header-section-number">24</span> Making slides for presentations</a></li>
<li><a class="" href="testing.html"><span class="header-section-number">25</span> Checking your work</a></li>
<li><a class="" href="dynamic.html"><span class="header-section-number">26</span> Dynamic graphics</a></li>
<li><a class="" href="mapping-1.html"><span class="header-section-number">27</span> Making maps</a></li>
<li><a class="" href="mapping-2.html"><span class="header-section-number">28</span> Mapping part two</a></li>
<li><a class="" href="mapping-3.html"><span class="header-section-number">29</span> Alternatives to maps</a></li>
<li><a class="" href="factors-dates.html"><span class="header-section-number">30</span> Working with factors and dates</a></li>
<li><a class="" href="colour.html"><span class="header-section-number">31</span> Using colour well</a></li>
<li><a class="" href="theme.html"><span class="header-section-number">32</span> Themes</a></li>
<li><a class="" href="output-files.html"><span class="header-section-number">33</span> Graphics formatting</a></li>
<li><a class="" href="organization.html"><span class="header-section-number">34</span> Staying organized</a></li>
<li><a class="" href="r-details.html"><span class="header-section-number">35</span> More details about R</a></li>
<li><a class="" href="accessibility-bias-and-ethics.html"><span class="header-section-number">36</span> Accessibility, Bias, and Ethics</a></li>
<li><a class="" href="metadata.html">Metadata</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/AndrewIrwin/data-visualization">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="summarizing-data" class="section level1" number="9">
<h1>
<span class="header-section-number">9</span> Summarizing data<a class="anchor" aria-label="anchor" href="#summarizing-data"><i class="fas fa-link"></i></a>
</h1>
<p>The tidyverse packages provide powerful tools for transforming and summarizing data. In this lesson we will explore the methods I use most frequently, including</p>
<ul>
<li>
<code>mutate</code> for defining new variables based on existing variables,</li>
<li>
<code>filter</code> for including or excluding observations (rows) according to the values of one or more variables,</li>
<li>
<code>group_by</code> for dividing a data table in to a set of groups according to one or more variables, before summarizing the data, and</li>
<li>
<code>summarise</code> for reducing a table to a single row or a single row for each value of a grouped variable.</li>
</ul>
<p>These tools mirror the methods used by database software for querying and summarizing data, such as the widely used SQL data query language. The correspondence is close enough that the tools can be used directly on databases by translating the tidyverse code into SQL with the <code>dbplyr</code> package. In databases, there are often links between two or more tables and information be combined using “joins”; R has all the standard joins for <a href="https://r4ds.had.co.nz/relational-data.html">combining data from two or more tables</a> into one.</p>
<p>There are many other data manipulation and reduction tools to be learned, but these four functions are the foundation for a huge number of calculations to help you understand, simplify, summarize and communicate information about a dataset.</p>
<p>We will work with the <code>diamonds</code> dataset; it’s fairly large and has a combination of quantitative and categorical data which can be used to illustrate these methods. R4DS <a href="https://r4ds.had.co.nz/transform.html">chapter 5</a> does many similar demostrations with a large database of flight data. You should practice all these calculations on a data set of your choice (some ideas are <a href="data-sources.html#data-sources">here</a>).</p>
<div id="creating-new-variables-with-mutate" class="section level2" number="9.1">
<h2>
<span class="header-section-number">9.1</span> Creating new variables with mutate<a class="anchor" aria-label="anchor" href="#creating-new-variables-with-mutate"><i class="fas fa-link"></i></a>
</h2>
<p>The diamonds data has dimensions (x, y, and z) and a mass (carat) of each diamond. It might be interesting to compare a <a href="https://en.wikipedia.org/wiki/Cuboid">cuboid</a> approximation of the diamond to its mass to get a quantitative measure of how different each diamond is from a box. To start, we’ll create a new variable called <code>box</code> defined by the product of x, y, and z. Then we’ll create the ratio <code>box_ratio</code> as the quotient of its mass (<code>carat</code>) and this volume.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>box <span class="op">=</span> <span class="va">x</span><span class="op">*</span><span class="va">y</span><span class="op">*</span><span class="va">z</span>,
         box_ratio <span class="op">=</span> <span class="va">carat</span> <span class="op">/</span> <span class="va">box</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 12
##   carat cut    color clarity depth table price     x     y     z   box box_ratio
##   &lt;dbl&gt; &lt;ord&gt;  &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1 0.23  Ideal  E     SI2      61.5    55   326  3.95  3.98  2.43  38.2   0.00602
## 2 0.21  Premi… E     SI1      59.8    61   326  3.89  3.84  2.31  34.5   0.00609
## 3 0.23  Good   E     VS1      56.9    65   327  4.05  4.07  2.31  38.1   0.00604
## 4 0.290 Premi… I     VS2      62.4    58   334  4.2   4.23  2.63  46.7   0.00621
## 5 0.31  Good   J     SI2      63.3    58   335  4.34  4.35  2.75  51.9   0.00597
## 6 0.24  Very … J     VVS2     62.8    57   336  3.94  3.96  2.48  38.7   0.00620</code></pre>
<p>This function adds two new columns to the data table, computing values for every row in the table. It doesn’t change any of the other columns. You can also modify an existing column, for example to change units from dollars to thousands of dollars or carats to grams, by using the name of an existing column on the left hand side of the equals sign.</p>
<p>A few things to note:</p>
<ul>
<li>We use the name of a column to create or modify on the left hand side of the equals sign/</li>
<li>We use an <code><a href="https://rdrr.io/r/base/assignOps.html">=</a></code> instead of <code><a href="https://rdrr.io/r/base/assignOps.html">&lt;-</a></code> when creating or modifying columns. The arrow is used to assign values to new R objects in your environment (see the Environment tab in R studio); here we are modifying the columns of a data frame so a different notation is appropriate.</li>
<li>The transformation shown above does not modify the <code>diamonds</code> object – it creates a new object, which you can then store in a new R variable in your environment. I often perform transformations simply for the purposes of making a table or a plot without ever storing the the result.</li>
</ul>
</div>
<div id="filtering-rows" class="section level2" number="9.2">
<h2>
<span class="header-section-number">9.2</span> Filtering rows<a class="anchor" aria-label="anchor" href="#filtering-rows"><i class="fas fa-link"></i></a>
</h2>
<p>Tbe <code>diamonds</code> data has many rows (more than 50,000). You might be interested in just a subset of the rows. We use <code>filter</code> to select rows to keep from a table. (We can specify rows to remove and use the logical not operator <code><a href="https://rdrr.io/r/base/Logic.html">!</a></code> to reverse the logic and keep all the other rows.)</p>
<p>For example, there are only 5 diamonds of more than 4 carats:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">carat</span> <span class="op">&gt;</span> <span class="fl">4</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 10
##   carat cut     color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt;   &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  4.01 Premium I     I1       61      61 15223  10.1 10.1   6.17
## 2  4.01 Premium J     I1       62.5    62 15223  10.0  9.94  6.24
## 3  4.13 Fair    H     I1       64.8    61 17329  10    9.85  6.43
## 4  5.01 Fair    J     I1       65.5    59 18018  10.7 10.5   6.98
## 5  4.5  Fair    J     I1       65.8    58 18531  10.2 10.2   6.72</code></pre>
<p>You can combine filtering operations by chaining them together with commas, pipes, or using boolean logic (<code><a href="https://rdrr.io/r/base/Logic.html">&amp;</a></code> for and; <code><a href="https://rdrr.io/r/base/Logic.html">|</a></code> for or). The following three expressions all do the same thing.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">color</span> <span class="op">==</span> <span class="st">"J"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">cut</span> <span class="op">==</span> <span class="st">"Premium"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">carat</span> <span class="op">&gt;</span> <span class="fl">3.0</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 10
##   carat cut     color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt;   &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  4.01 Premium J     I1       62.5    62 15223 10.0   9.94  6.24
## 2  3.51 Premium J     VS2      62.5    59 18701  9.66  9.63  6.03
## 3  3.01 Premium J     SI2      60.7    59 18710  9.35  9.22  5.64
## 4  3.01 Premium J     SI2      59.7    58 18710  9.41  9.32  5.59</code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">color</span> <span class="op">==</span> <span class="st">"J"</span>, <span class="va">cut</span> <span class="op">==</span> <span class="st">"Premium"</span>, <span class="va">carat</span> <span class="op">&gt;</span> <span class="fl">3.0</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 10
##   carat cut     color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt;   &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  4.01 Premium J     I1       62.5    62 15223 10.0   9.94  6.24
## 2  3.51 Premium J     VS2      62.5    59 18701  9.66  9.63  6.03
## 3  3.01 Premium J     SI2      60.7    59 18710  9.35  9.22  5.64
## 4  3.01 Premium J     SI2      59.7    58 18710  9.41  9.32  5.59</code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">color</span> <span class="op">==</span> <span class="st">"J"</span> <span class="op">&amp;</span> <span class="va">cut</span> <span class="op">==</span> <span class="st">"Premium"</span> <span class="op">&amp;</span> <span class="va">carat</span> <span class="op">&gt;</span> <span class="fl">3.0</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 10
##   carat cut     color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt;   &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  4.01 Premium J     I1       62.5    62 15223 10.0   9.94  6.24
## 2  3.51 Premium J     VS2      62.5    59 18701  9.66  9.63  6.03
## 3  3.01 Premium J     SI2      60.7    59 18710  9.35  9.22  5.64
## 4  3.01 Premium J     SI2      59.7    58 18710  9.41  9.32  5.59</code></pre>
<p>The second example a convenient abbreviation of the first, but why would we want the third way? Because we can use a logical “or” instead of an and to make different kinds of selections. For example, we might want all the diamonds that meet <em>any</em> of three different tests.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">(</span><span class="va">color</span> <span class="op">==</span> <span class="st">"J"</span> <span class="op">|</span> <span class="va">cut</span> <span class="op">==</span> <span class="st">"Premium"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">carat</span> <span class="op">&gt;</span> <span class="fl">4.0</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 10
##   carat cut     color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt;   &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  4.01 Premium I     I1       61      61 15223  10.1 10.1   6.17
## 2  4.01 Premium J     I1       62.5    62 15223  10.0  9.94  6.24
## 3  5.01 Fair    J     I1       65.5    59 18018  10.7 10.5   6.98
## 4  4.5  Fair    J     I1       65.8    58 18531  10.2 10.2   6.72</code></pre>
<p>These logical expressions can be challenging to interpret, so use care and test them carefully to be sure the calculation does what you think it should.</p>
</div>
<div id="getting-just-some-rows-and-columns" class="section level2" number="9.3">
<h2>
<span class="header-section-number">9.3</span> Getting just some rows and columns<a class="anchor" aria-label="anchor" href="#getting-just-some-rows-and-columns"><i class="fas fa-link"></i></a>
</h2>
<p>All of the tables above showed all 10 columns. Sometimes you only want some of the columns. Use <code>select</code> to extract and reorder columns:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">price</span>, <span class="va">cut</span>, <span class="va">color</span>, <span class="va">clarity</span>, <span class="va">carat</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   price cut       color clarity carat
##   &lt;int&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt;
## 1   326 Ideal     E     SI2     0.23 
## 2   326 Premium   E     SI1     0.21 
## 3   327 Good      E     VS1     0.23 
## 4   334 Premium   I     VS2     0.290
## 5   335 Good      J     SI2     0.31 
## 6   336 Very Good J     VVS2    0.24</code></pre>
<p>You’ll notice I’ve used <code>head</code> to get just the first 6 rows of the data table. You can also use <code>tail</code> to get the last few rows. And you can modify the number of rows (see the help page for head and tail.)</p>
<p>A more general method for extracting rows by number is <code>slice</code>.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu">slice</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span>, <span class="fl">200</span>, <span class="fl">1000</span>, <span class="fl">5000</span>, <span class="fl">1000</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 10
##   carat cut       color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  0.23 Ideal     E     SI2      61.5    55   326  3.95  3.98  2.43
## 2  0.8  Premium   H     SI1      61.5    58  2760  5.97  5.93  3.66
## 3  0.72 Premium   F     SI1      61.8    61  2777  5.82  5.71  3.56
## 4  1.12 Premium   J     SI2      60.6    59  2898  6.68  6.61  4.03
## 5  1.05 Very Good I     SI2      62.3    59  3742  6.42  6.46  4.01
## 6  1.12 Premium   J     SI2      60.6    59  2898  6.68  6.61  4.03</code></pre>
<p>Sometimes with a large dataset I want to look at a random subset of all the rows. Use these variants on <code>slice_</code> for that task. (Try it yourself: you will get different rows each time.)</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu">slice_sample</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 10
##   carat cut       color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  1.59 Premium   E     SI1      58.8    59  9705  7.69  7.61  4.5 
## 2  0.3  Very Good E     VS1      61.4    59   653  4.32  4.28  2.64
## 3  0.92 Very Good E     SI1      62.1    58  4562  6.15  6.22  3.84
## 4  0.41 Ideal     J     VS1      62.8    56   707  4.73  4.79  2.99
## 5  1.54 Ideal     I     SI1      63.5    61  9942  7.29  7.33  4.64</code></pre>
<p>You can use <code>arrange</code> to sort the data by any number of columns before slicing or displaying the data.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu">arrange</span><span class="op">(</span><span class="va">cut</span>, <span class="op">-</span><span class="va">color</span>, <span class="op">-</span><span class="va">carat</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">carat</span>, <span class="va">cut</span>, <span class="va">color</span>, <span class="va">price</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in Ops.ordered(color): '-' is not meaningful for ordered factors</code></pre>
<pre><code>## # A tibble: 10 x 4
##    carat cut   color price
##    &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt; &lt;int&gt;
##  1  5.01 Fair  J     18018
##  2  4.5  Fair  J     18531
##  3  4.13 Fair  H     17329
##  4  3.65 Fair  H     11668
##  5  3.4  Fair  D     15964
##  6  3.11 Fair  J      9823
##  7  3.02 Fair  I     10577
##  8  3.01 Fair  H     10761
##  9  3.01 Fair  I     18242
## 10  3.01 Fair  I     18242</code></pre>
<p>You’ll notice that there are only a few levels of each of the categorical variables (cut, color, clarity). Suppose you want to see all combinations that exist? Use select to pick out those rows, then <code>distinct</code> to show only the rows that are different from each other. (There are 276 combinations, so I’m showing only the top 5, after sorting.)</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">cut</span>, <span class="va">clarity</span>, <span class="va">color</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">arrange</span><span class="op">(</span><span class="va">color</span>, <span class="va">clarity</span>, <span class="va">cut</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 3
##   cut       clarity color
##   &lt;ord&gt;     &lt;ord&gt;   &lt;ord&gt;
## 1 Fair      I1      D    
## 2 Good      I1      D    
## 3 Very Good I1      D    
## 4 Premium   I1      D    
## 5 Ideal     I1      D</code></pre>
</div>
<div id="summarizing-data-tables" class="section level2" number="9.4">
<h2>
<span class="header-section-number">9.4</span> Summarizing data tables<a class="anchor" aria-label="anchor" href="#summarizing-data-tables"><i class="fas fa-link"></i></a>
</h2>
<p>These filtering and transformation functions are powerful and encourage a really useful way of probing a complext dataset. The <code>summarize</code> (or <code>summarise</code>) provides a way to apply a function to one or more variables across all the rows or colletions of rows. To use this effectively you want to think of functions that operate on a set of numbers and return just a single one, such as <code>mean</code>, <code>median</code>, <code>max</code>, <code>min</code>, <code>sd</code>, or the simplest of all <code>n</code> which counts the number of rows.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu">summarise</span><span class="op">(</span>n_rows <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>, 
                       mean_price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span>,
                       median_price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span>,
                       min_carat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">carat</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   n_rows mean_price median_price min_carat
##    &lt;int&gt;      &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;
## 1  53940      3933.         2401       0.2</code></pre>
<p>All the original data is gone, replaced by these four functions applied to all the data in the corresponding column. The name of the new column appears on the left side of the <code><a href="https://rdrr.io/r/base/assignOps.html">=</a></code> and the calculation on the right. This is the same way we wrote the <code>mutate</code> function, but instead of creating a new variable and computing a value for each row, we get one value computed using all the rows.</p>
<p>Rows can be grouped to get summaries for each level of the grouped varible. Let’s group on <code>cut</code> but otherwise repeat this calculation:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">cut</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>n_rows <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>, 
                       mean_price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span>,
                       median_price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span>,
                       min_carat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">carat</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 5
##   cut       n_rows mean_price median_price min_carat
## * &lt;ord&gt;      &lt;int&gt;      &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;
## 1 Fair        1610      4359.        3282       0.22
## 2 Good        4906      3929.        3050.      0.23
## 3 Very Good  12082      3982.        2648       0.2 
## 4 Premium    13791      4584.        3185       0.2 
## 5 Ideal      21551      3458.        1810       0.2</code></pre>
<p>Now we get 5 rows.</p>
<p>You can group on as many variables at once as you like; the result will have one row for each combination of levels from each grouped variable. (You can even group on quantitative varibles, but you usually don’t want to!)</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">cut</span>, <span class="va">clarity</span>, <span class="va">color</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>n_rows <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>, 
                       mean_price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span>,
                       median_price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span>,
                       min_carat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">carat</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 7
## # Groups:   cut, clarity [1]
##   cut   clarity color n_rows mean_price median_price min_carat
##   &lt;ord&gt; &lt;ord&gt;   &lt;ord&gt;  &lt;int&gt;      &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;
## 1 Fair  I1      D          4      7383         5538.      0.91
## 2 Fair  I1      E          9      2095.        2036       0.7 
## 3 Fair  I1      F         35      2544.        1570       0.34
## 4 Fair  I1      G         53      3187.        1954       0.5 
## 5 Fair  I1      H         52      4213.        3340.      0.7</code></pre>
<p>Grouping doen’t do any calculations, it just makes a notation on a data frame that your grouping should be used for subsequent calculations that pay attention to grouping. After you summarise data, one grouping variable is removed (the last one) but the result is still grouped by the remaining variables. (See the notation: Groups: cut, clarity in the result above.)</p>
<p><code>summarise</code> has an optional argument <code>.groups</code> to say what grouping you want to retain after the calculation is done. <code>drop_last</code> is the default, described above. Probably the next most frequently used choice is <code>drop</code> which ungroups all the rows. To see the diference, I’ll add another step, <code>count()</code>, which is equivalent to <code>summarise(n=n())</code> and counts rows.</p>
<p>Using <code>drop_last</code> I get the number of rows for each level of cut and clarity (usually 7 for the levels of color: D, E, F, G, H, I, J) for all 40 combinations of cut and clarity (only a few shown here.)</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">cut</span>, <span class="va">clarity</span>, <span class="va">color</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>n_rows <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>, 
                       mean_price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span>,
                       median_price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span>,
                       min_carat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">carat</span><span class="op">)</span>,
             .groups<span class="op">=</span><span class="st">"drop_last"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">count</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
## # Groups:   cut, clarity [6]
##   cut   clarity     n
##   &lt;ord&gt; &lt;ord&gt;   &lt;int&gt;
## 1 Fair  I1          7
## 2 Fair  SI2         7
## 3 Fair  SI1         7
## 4 Fair  VS2         7
## 5 Fair  VS1         7
## 6 Fair  VVS2        7</code></pre>
<p>Change the options to <code>.groups = "drop"</code> and I get a very different result – just the number of combinations of cut, clarity, and color (276 of the maximum 5 x 8 x 7 = 280 which are possible):</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">cut</span>, <span class="va">clarity</span>, <span class="va">color</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>n_rows <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>, 
                       mean_price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span>,
                       median_price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span>,
                       min_carat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">carat</span><span class="op">)</span>,
            .groups<span class="op">=</span><span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">count</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1   276</code></pre>
<p>You can also use <code>ungroup()</code> following a <code>summarise</code> to discard all grouping if you don’t want to use the <code>.groups</code> argument.</p>
</div>
<div id="example" class="section level2" number="9.5">
<h2>
<span class="header-section-number">9.5</span> Example<a class="anchor" aria-label="anchor" href="#example"><i class="fas fa-link"></i></a>
</h2>
<p>These methods can be combined together to produce elaborate queries. For example, let’s use mutate to compute a price per carat ratio, then find the median of this ratio over all diamonds grouped by cut, color, and clarity. Also report the sample size used for each median. Finally we will extract the top 2 ratios for each cut type (using a grouped slice) and arrange the resulting table from largest to smallest ratio.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>price_per_carat <span class="op">=</span> <span class="va">price</span> <span class="op">/</span> <span class="va">carat</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">color</span>, <span class="va">clarity</span>, <span class="va">cut</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>median_price_per_carat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">price_per_carat</span><span class="op">)</span>, 
            n <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,
            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="op">-</span><span class="va">median_price_per_carat</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">cut</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">slice_head</span><span class="op">(</span>n<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="op">-</span><span class="va">median_price_per_carat</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 5
## # Groups:   cut [5]
##    color clarity cut       median_price_per_carat     n
##    &lt;ord&gt; &lt;ord&gt;   &lt;ord&gt;                      &lt;dbl&gt; &lt;int&gt;
##  1 D     IF      Good                      14932.     9
##  2 D     IF      Premium                   11057.    10
##  3 D     IF      Very Good                 10202.    23
##  4 D     IF      Ideal                      7162.    28
##  5 J     VVS1    Premium                    5336.    24
##  6 J     VVS2    Very Good                  5227.    29
##  7 H     IF      Good                       5100.     4
##  8 E     VVS1    Fair                       4921.     3
##  9 G     VS2     Fair                       4838     45
## 10 H     SI1     Ideal                      4469.   763</code></pre>
<p>When I did this calculation the first time, I forgot the first <code>arrange</code>. Why is it needed before the grouped <code>slice_head</code>? (Remove it and see how the result changes. Try removing the slice_head to see the full results.) Why is the second <code>arrange</code> needed?</p>
<p>The top 4 price per carat categories are all the best colour (D) and clarity (IF), but cut seems to be less important in determining this ratio. One of the top 10 categories has a lot of diamonds in it (763), while the other groups have very few diamonds relative to the size of the whole dataset (more than 50,000).</p>
</div>
<div id="what-does-this-have-to-do-with-data-visualization" class="section level2" number="9.6">
<h2>
<span class="header-section-number">9.6</span> What does this have to do with data visualization?<a class="anchor" aria-label="anchor" href="#what-does-this-have-to-do-with-data-visualization"><i class="fas fa-link"></i></a>
</h2>
<p>These tools are very useful for exploring data; helping you understand the structure of your data. This will help you make better visualizations. In particular, the humble <code>n</code> function which counts rows should be used frequently when you summarize with mean or median to let you know if you have very few observations or too many for a good plot.</p>
<p>Summarizing data, for example by computing means and standard errors can be done as part of the visualization process using <code>stat_summary</code>, but it can be easier to know exactly what you are calculating if you compute the summary yourself using the methods in this lesson and then plot the results.</p>
<p>Tables can be a useful way to visualize data and grouped summaries are often the easiest way to make a table to describe your data.</p>
</div>
<div id="further-reading-5" class="section level2" number="9.7">
<h2>
<span class="header-section-number">9.7</span> Further reading<a class="anchor" aria-label="anchor" href="#further-reading-5"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>R4DS. Chapter 5 on <a href="https://r4ds.had.co.nz/transform.html">Data transformations</a>
</li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="ggplot.html"><span class="header-section-number">8</span> Using the grammar of graphics</a></div>
<div class="next"><a href="facets.html"><span class="header-section-number">10</span> Facetted graphs</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#summarizing-data"><span class="header-section-number">9</span> Summarizing data</a></li>
<li><a class="nav-link" href="#creating-new-variables-with-mutate"><span class="header-section-number">9.1</span> Creating new variables with mutate</a></li>
<li><a class="nav-link" href="#filtering-rows"><span class="header-section-number">9.2</span> Filtering rows</a></li>
<li><a class="nav-link" href="#getting-just-some-rows-and-columns"><span class="header-section-number">9.3</span> Getting just some rows and columns</a></li>
<li><a class="nav-link" href="#summarizing-data-tables"><span class="header-section-number">9.4</span> Summarizing data tables</a></li>
<li><a class="nav-link" href="#example"><span class="header-section-number">9.5</span> Example</a></li>
<li><a class="nav-link" href="#what-does-this-have-to-do-with-data-visualization"><span class="header-section-number">9.6</span> What does this have to do with data visualization?</a></li>
<li><a class="nav-link" href="#further-reading-5"><span class="header-section-number">9.7</span> Further reading</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/AndrewIrwin/data-visualization/blob/master/110-summarizing-data.rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/AndrewIrwin/data-visualization/edit/master/110-summarizing-data.rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Visualization</strong>" was written by Andrew Irwin. It was last built on 2021-03-10.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
