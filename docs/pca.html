<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 21 Principal component analysis | Data Visualization</title>
<meta name="author" content="Andrew Irwin">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6.4/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><script src="libs/plotly-binding-4.9.3/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Visualization</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="syllabus.html">Syllabus</a></li>
<li><a class="" href="outline.html">Detailed outline</a></li>
<li><a class="" href="sync.html">Synchronous meeting agendas</a></li>
<li><a class="" href="evaluation.html">Evaluation</a></li>
<li><a class="" href="ch-invitation.html"><span class="header-section-number">1</span> Invitation to Data Visualization</a></li>
<li><a class="" href="ch-tools.html"><span class="header-section-number">2</span> Computer tools</a></li>
<li><a class="" href="setup.html"><span class="header-section-number">3</span> Setting up your computer</a></li>
<li><a class="" href="look-data.html"><span class="header-section-number">4</span> Look at Data</a></li>
<li><a class="" href="first-plot.html"><span class="header-section-number">5</span> Making your first plot</a></li>
<li><a class="" href="vcs.html"><span class="header-section-number">6</span> What is version control software?</a></li>
<li><a class="" href="grammar.html"><span class="header-section-number">7</span> Grammar of Graphics</a></li>
<li><a class="" href="ggplot.html"><span class="header-section-number">8</span> Using the grammar of graphics</a></li>
<li><a class="" href="summarizing-data.html"><span class="header-section-number">9</span> Summarizing data</a></li>
<li><a class="" href="facets.html"><span class="header-section-number">10</span> Facetted graphs</a></li>
<li><a class="" href="reading-data.html"><span class="header-section-number">11</span> Reading data</a></li>
<li><a class="" href="pivot.html"><span class="header-section-number">12</span> Reshaping data</a></li>
<li><a class="" href="format-tables.html"><span class="header-section-number">13</span> Format tables</a></li>
<li><a class="" href="help.html"><span class="header-section-number">14</span> Getting help and asking questions</a></li>
<li><a class="" href="working-models.html"><span class="header-section-number">15</span> Working with models</a></li>
<li><a class="" href="linear-models.html"><span class="header-section-number">16</span> Linear models</a></li>
<li><a class="" href="smoothing.html"><span class="header-section-number">17</span> GAM and LOESS smoothing</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">18</span> Collaborating with GitHub</a></li>
<li><a class="" href="data-sources.html"><span class="header-section-number">19</span> Finding and accessing data</a></li>
<li><a class="" href="reproduce.html"><span class="header-section-number">20</span> Reproducible reports</a></li>
<li><a class="active" href="pca.html"><span class="header-section-number">21</span> Principal component analysis</a></li>
<li><a class="" href="mds.html"><span class="header-section-number">22</span> Multidimensional scaling</a></li>
<li><a class="" href="k-means.html"><span class="header-section-number">23</span> K-means clustering</a></li>
<li><a class="" href="slides.html"><span class="header-section-number">24</span> Making slides for presentations</a></li>
<li><a class="" href="testing.html"><span class="header-section-number">25</span> Is my work right?</a></li>
<li><a class="" href="dynamic.html"><span class="header-section-number">26</span> Dynamic graphics</a></li>
<li><a class="" href="mapping-1.html"><span class="header-section-number">27</span> Making maps</a></li>
<li><a class="" href="mapping-2.html"><span class="header-section-number">28</span> Mapping part two</a></li>
<li><a class="" href="mapping-3.html"><span class="header-section-number">29</span> Alternatives to maps</a></li>
<li><a class="" href="factors-dates.html"><span class="header-section-number">30</span> Working with factors and dates</a></li>
<li><a class="" href="colour.html"><span class="header-section-number">31</span> Using colour well</a></li>
<li><a class="" href="theme.html"><span class="header-section-number">32</span> Themes</a></li>
<li><a class="" href="output-files.html"><span class="header-section-number">33</span> Graphics formatting</a></li>
<li><a class="" href="organization.html"><span class="header-section-number">34</span> Staying organized</a></li>
<li><a class="" href="r-details.html"><span class="header-section-number">35</span> More details about R</a></li>
<li><a class="" href="accessibility-bias-and-ethics.html"><span class="header-section-number">36</span> Accessibility, Bias, and Ethics</a></li>
<li><a class="" href="metadata.html">Metadata</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/AndrewIrwin/data-visualization">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="pca" class="section level1" number="21">
<h1>
<span class="header-section-number">21</span> Principal component analysis<a class="anchor" aria-label="anchor" href="#pca"><i class="fas fa-link"></i></a>
</h1>
<p>Datasets are said to be high-dimensional when several quantitative (or categorical) variables are recorded for each observation. Visualizing these datasets can be challenging, because visualizations work best with two dimensions and it is difficult to visualize 4 or more dimensions simultaneously. Many plots of pairs of variables can be displayed, but these projections require the viewer to try to reconstruct complex interactions among variables. <a href="https://en.wikipedia.org/wiki/Ordination_(statistics)">Ordination</a> is a suite of techniques for creating projections of high-dimensional data, usually in 2 or 3 dimensions. The name refers to the goal of <em>ordering</em> observations in a two dimensional plane so that observations which are close in the high-dimensional space are still close in the projected 2-dimensional space. Not all features of the original dataset can be maintained – information is lost – so some care must be taken when interpreting ordination plots. In this course we will examine Principal Component Analysis (in this lesson) and metric and non-metric dimensional analysis (in the next). There are many other techniques for <a href="https://en.wikipedia.org/wiki/Dimensionality_reduction">dimensionality reduction</a>.</p>
<p>Principal component analysis (from now on, PCA) defines new variables which are weighted sums (a.k.a. linear combinations) of variables in your data. These sums are called principal components. The principal components can be used as new axes for your data, defining new coordinates for each point. The underlying transformation is a rotation (and usually a scaling) which is used to form a new coordinate system. The coordinate along each axis known as the first, second, etc., principal component. The rotation is chosen to maximize the variance in the first principal component. The second principal component is perpendicular to the first, but chosen so that as much of the remaining variation as possible is along that axis. And so on. In this way you can select as many of the first few principal components as you like to have a smaller set of variables that represent as much of the variation in the original data as possible.</p>
<p>If you have studied linear algebra, you will want to know that the principal component analysis is performed with the following steps:</p>
<ul>
<li>center the data at the origin by subtracting the mean of each variable (optionally scale each variable to have the same standard deviation),</li>
<li>compute the covariance matrix (or optionally the correlation matrix),</li>
<li>compute the eigenvalues of the covariance matrix.</li>
</ul>
<p>The eigenvalues and their corresponding eigenvectors are sorted from largest to smallest.
The proportion of the variance explained by each principal component is proportional to the eigenvalues.
The rotation matrix is the orthogonal matrix composed of these eigenvalues.
This is explained in our applied linear algebra course (Math 2040) in section 11.12 of <a href="https://www.mathstat.dal.ca/~selinger/linear-algebra/">Peter Selinger’s book</a> textbook.</p>
<div id="example-1" class="section level2" number="21.1">
<h2>
<span class="header-section-number">21.1</span> Example<a class="anchor" aria-label="anchor" href="#example-1"><i class="fas fa-link"></i></a>
</h2>
<p>A simple example in two dimensions is really helpful. No one does PCA on two variables, because you can just plot the data in a normal scatterplot, but as a demonstration it shows how the principal components are chosen.</p>
<p>First, let’s look at a regular scatterplot of two variables that have a reasonably strong linear relationship. I’ve used <code>coord_fixed</code> to force the same scale on the vertical and horizontal axes, to make this plot easier to compare with the next plot we will draw.</p>
<div class="sourceCode" id="cb251"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">speed</span>, y<span class="op">=</span><span class="va">dist</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="121-PCA_files/figure-html/unnamed-chunk-2-1.png" width="672"></div>
<p>Now let’s perform the PCA. There are three results: the amount of variation accounted for by each principal component, the directions of the principal components along each of the original axes, and the coordinates of the observations along the principal component axes.</p>
<div class="sourceCode" id="cb252"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pca1</span> <span class="op">&lt;-</span> <span class="va">cars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The <code>tidy</code> functions let you obtain</p>
<ul>
<li>the percent of the total variance projected along (“explained by”) each principal component (determined by the eigenvalues)</li>
<li>the directions of the original axes along the new principal component axes (rotation)</li>
<li>the original data transformed to the new principal component axes (scores)</li>
</ul>
<div class="sourceCode" id="cb253"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pca1</span> <span class="op">%&gt;%</span> <span class="fu">tidy</span><span class="op">(</span>matrix <span class="op">=</span> <span class="st">"eigenvalues"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">kable</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
PC
</th>
<th style="text-align:right;">
std.dev
</th>
<th style="text-align:right;">
percent
</th>
<th style="text-align:right;">
cumulative
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
26.12524
</td>
<td style="text-align:right;">
0.98628
</td>
<td style="text-align:right;">
0.98628
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3.08084
</td>
<td style="text-align:right;">
0.01372
</td>
<td style="text-align:right;">
1.00000
</td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pca1</span> <span class="op">%&gt;%</span> <span class="fu">tidy</span><span class="op">(</span>matrix <span class="op">=</span> <span class="st">"rotation"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">kable</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
column
</th>
<th style="text-align:right;">
PC
</th>
<th style="text-align:right;">
value
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
speed
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.1656479
</td>
</tr>
<tr>
<td style="text-align:left;">
speed
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-0.9861850
</td>
</tr>
<tr>
<td style="text-align:left;">
dist
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.9861850
</td>
</tr>
<tr>
<td style="text-align:left;">
dist
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.1656479
</td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb255"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pca1</span> <span class="op">%&gt;%</span> <span class="fu">tidy</span><span class="op">(</span>matrix <span class="op">=</span> <span class="st">"scores"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"PC"</span>, names_prefix <span class="op">=</span> <span class="st">"PC_"</span>, values_from <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">kable</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">scroll_box</span><span class="op">(</span>height <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:50; ">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
row
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
PC_1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
PC_2
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
42.3022457
</td>
<td style="text-align:right;">
4.4542578
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
34.4127660
</td>
<td style="text-align:right;">
5.7794410
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
39.8329321
</td>
<td style="text-align:right;">
1.8269987
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
22.0816028
</td>
<td style="text-align:right;">
4.8086608
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
27.8330646
</td>
<td style="text-align:right;">
2.8285885
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
33.5845265
</td>
<td style="text-align:right;">
0.8485162
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
25.5293989
</td>
<td style="text-align:right;">
1.1875144
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
17.6399193
</td>
<td style="text-align:right;">
2.5126975
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
9.7504396
</td>
<td style="text-align:right;">
3.8378807
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
26.3499360
</td>
<td style="text-align:right;">
0.0356815
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
15.5019014
</td>
<td style="text-align:right;">
1.8578084
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
29.1428430
</td>
<td style="text-align:right;">
-1.4474471
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
23.2257332
</td>
<td style="text-align:right;">
-0.4535598
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
19.2809934
</td>
<td style="text-align:right;">
0.2090318
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
15.3362535
</td>
<td style="text-align:right;">
0.8716234
</td>
</tr>
<tr>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
17.1429756
</td>
<td style="text-align:right;">
-0.4458574
</td>
</tr>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
9.2534959
</td>
<td style="text-align:right;">
0.8793258
</td>
</tr>
<tr>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
9.2534959
</td>
<td style="text-align:right;">
0.8793258
</td>
</tr>
<tr>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
-2.5807236
</td>
<td style="text-align:right;">
2.8671005
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
16.9773277
</td>
<td style="text-align:right;">
-1.4320423
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
7.1154781
</td>
<td style="text-align:right;">
0.2244366
</td>
</tr>
<tr>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
-16.5529610
</td>
<td style="text-align:right;">
4.1999861
</td>
</tr>
<tr>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
-36.2766602
</td>
<td style="text-align:right;">
7.5129440
</td>
</tr>
<tr>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
22.7287895
</td>
<td style="text-align:right;">
-3.4121147
</td>
</tr>
<tr>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
16.8116798
</td>
<td style="text-align:right;">
-2.4182273
</td>
</tr>
<tr>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
-10.8014991
</td>
<td style="text-align:right;">
2.2199138
</td>
</tr>
<tr>
<td style="text-align:right;">
27
</td>
<td style="text-align:right;">
10.7289221
</td>
<td style="text-align:right;">
-2.4105249
</td>
</tr>
<tr>
<td style="text-align:right;">
28
</td>
<td style="text-align:right;">
2.8394424
</td>
<td style="text-align:right;">
-1.0853417
</td>
</tr>
<tr>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
10.5632742
</td>
<td style="text-align:right;">
-3.3967098
</td>
</tr>
<tr>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
2.6737945
</td>
<td style="text-align:right;">
-2.0715267
</td>
</tr>
<tr>
<td style="text-align:right;">
31
</td>
<td style="text-align:right;">
-7.1880550
</td>
<td style="text-align:right;">
-0.4150477
</td>
</tr>
<tr>
<td style="text-align:right;">
32
</td>
<td style="text-align:right;">
0.5357767
</td>
<td style="text-align:right;">
-2.7264158
</td>
</tr>
<tr>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
-13.2708127
</td>
<td style="text-align:right;">
-0.4073453
</td>
</tr>
<tr>
<td style="text-align:right;">
34
</td>
<td style="text-align:right;">
-32.9945119
</td>
<td style="text-align:right;">
2.9056126
</td>
</tr>
<tr>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
-40.8839916
</td>
<td style="text-align:right;">
4.2307958
</td>
</tr>
<tr>
<td style="text-align:right;">
36
</td>
<td style="text-align:right;">
6.2872386
</td>
<td style="text-align:right;">
-4.7064882
</td>
</tr>
<tr>
<td style="text-align:right;">
37
</td>
<td style="text-align:right;">
-3.5746110
</td>
<td style="text-align:right;">
-3.0500092
</td>
</tr>
<tr>
<td style="text-align:right;">
38
</td>
<td style="text-align:right;">
-25.2706801
</td>
<td style="text-align:right;">
0.5942445
</td>
</tr>
<tr>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
10.0663305
</td>
<td style="text-align:right;">
-6.3552647
</td>
</tr>
<tr>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
-5.7126288
</td>
<td style="text-align:right;">
-3.7048984
</td>
</tr>
<tr>
<td style="text-align:right;">
41
</td>
<td style="text-align:right;">
-9.6573687
</td>
<td style="text-align:right;">
-3.0423068
</td>
</tr>
<tr>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
-13.6021085
</td>
<td style="text-align:right;">
-2.3797152
</td>
</tr>
<tr>
<td style="text-align:right;">
43
</td>
<td style="text-align:right;">
-21.4915882
</td>
<td style="text-align:right;">
-1.0545321
</td>
</tr>
<tr>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
-23.7952539
</td>
<td style="text-align:right;">
-2.6956062
</td>
</tr>
<tr>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
-12.1266823
</td>
<td style="text-align:right;">
-5.6695659
</td>
</tr>
<tr>
<td style="text-align:right;">
46
</td>
<td style="text-align:right;">
-28.0712895
</td>
<td style="text-align:right;">
-4.0053845
</td>
</tr>
<tr>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
-49.7673586
</td>
<td style="text-align:right;">
-0.3611308
</td>
</tr>
<tr>
<td style="text-align:right;">
48
</td>
<td style="text-align:right;">
-50.7535436
</td>
<td style="text-align:right;">
-0.1954829
</td>
</tr>
<tr>
<td style="text-align:right;">
49
</td>
<td style="text-align:right;">
-77.3805375
</td>
<td style="text-align:right;">
4.2770102
</td>
</tr>
<tr>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
-43.0297118
</td>
<td style="text-align:right;">
-2.5068510
</td>
</tr>
</tbody>
</table></div>
</div>
<p>We can perform these calculations “by hand” following the linear algebra instructions:</p>
<div class="sourceCode" id="cb256"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">carsM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">cars</span><span class="op">)</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  <span class="co"># If scale = TRUE, then use correlation matrix below</span>
<span class="va">B1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span><span class="op">(</span><span class="va">carsM</span><span class="op">)</span>  
<span class="va">B2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">carsM</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">carsM</span> <span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">carsM</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>  <span class="co"># divide (M^T * M) by N-1 to get covariance matrix</span>
<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span><span class="op">(</span><span class="va">B1</span><span class="op">)</span><span class="op">$</span><span class="va">values</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 26.12524  3.08084</code></pre>
<div class="sourceCode" id="cb258"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span><span class="op">(</span><span class="va">B1</span><span class="op">)</span><span class="op">$</span><span class="va">vectors</span></code></pre></div>
<pre><code>##           [,1]       [,2]
## [1,] 0.1656479 -0.9861850
## [2,] 0.9861850  0.1656479</code></pre>
<p>The the “scores” output is equal to the original data multiplied by the rotation matrix.</p>
<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rotation</span> <span class="op">&lt;-</span> <span class="va">pca1</span> <span class="op">%&gt;%</span> <span class="fu">tidy</span><span class="op">(</span>matrix <span class="op">=</span> <span class="st">"rotation"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>  <span class="co"># also available as  pca1$rotation</span>
<span class="va">center</span> <span class="op">&lt;-</span> <span class="va">cars</span> <span class="op">%&gt;%</span> <span class="fu">summarize</span><span class="op">(</span>speed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">speed</span><span class="op">)</span>, dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dist</span><span class="op">)</span><span class="op">)</span> <span class="co"># also available as pca1$center</span>
<span class="va">scores1</span> <span class="op">&lt;-</span> <span class="va">pca1</span> <span class="op">%&gt;%</span> <span class="fu">tidy</span><span class="op">(</span>matrix <span class="op">=</span> <span class="st">"scores"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co"># scores2 &lt;- t((t(cars) - pca1$center)) %*% pca1$rotation</span>
<span class="va">scores2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">cars</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">rotation</span></code></pre></div>
<p>Now I’ll plot the data projected onto the principal components. Notice that it is wide and thin (especially compared to the previous plot) because the data have been rotated to arrange as much of the variation as possible in the horizontal direction.</p>
<div class="sourceCode" id="cb261"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pca1</span> <span class="op">%&gt;%</span> <span class="fu">tidy</span><span class="op">(</span>matrix <span class="op">=</span> <span class="st">"scores"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_wider</span><span class="op">(</span>names_from<span class="op">=</span><span class="st">"PC"</span>, names_prefix <span class="op">=</span> <span class="st">"PC_"</span>, values_from <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC_1</span>, y<span class="op">=</span><span class="va">PC_2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="121-PCA_files/figure-html/unnamed-chunk-7-1.png" width="672"></div>
<p>An easy way to display the results of the PCA is to make a biplot using the <code>ggfortify</code> package. The biplot shows the observations as black dots and the original axes as red vectors. The option <code>scale=0</code> keeps the same scaling as in the original plot. In normal usage you would not have <code><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed()</a></code> in the original plot and you would not use <code>scale=0</code> in this plot.</p>
<div class="sourceCode" id="cb262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">pca1</span>, data<span class="op">=</span> <span class="va">cars</span>, loadings<span class="op">=</span><span class="cn">TRUE</span>, loadings.label<span class="op">=</span><span class="cn">TRUE</span>, scale<span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: `select_()` is deprecated as of dplyr 0.7.0.
## Please use `select()` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<div class="inline-figure"><img src="121-PCA_files/figure-html/unnamed-chunk-8-1.png" width="672"></div>
<p>Normal use of <code>autoplot</code> would be to allow changing the scale of the two principal components (<code>scale = 1</code>) and to allow the axes to be scaled independently of each other (no <code><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed()</a></code>):</p>
<div class="sourceCode" id="cb264"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">pca1</span>, data<span class="op">=</span> <span class="va">cars</span>, loadings<span class="op">=</span><span class="cn">TRUE</span>, loadings.label<span class="op">=</span><span class="cn">TRUE</span>, scale<span class="op">=</span><span class="fl">1</span>, variance_percentage <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="121-PCA_files/figure-html/unnamed-chunk-9-1.png" width="672"></div>
<p>The <code>autoplot</code> function is convenient and you can customize many features using the options in <code>ggbiplot</code>. I like to know exactly how a plot is drawn to check my understanding, so I’ll show you how to reproduce this plot using <code>augment</code> and <code>ggplot</code>.</p>
<p>We can make this plot (called a biplot) from the raw data by using a few scaling factors (lam, scaling) commonly used in these plots:</p>
<div class="sourceCode" id="cb265"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lam</span> <span class="op">&lt;-</span> <span class="va">pca1</span><span class="op">$</span><span class="va">sdev</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pca1</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
<span class="va">scaling</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">scores2</span><span class="op">)</span>, <span class="fl">2</span>, <span class="va">max</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">rotation</span><span class="op">)</span>, <span class="fl">2</span>, <span class="va">max</span><span class="op">)</span> <span class="op">/</span> <span class="va">lam</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.8</span>
<span class="va">ve</span> <span class="op">&lt;-</span> <span class="va">pca1</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pca1</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="va">scores2</span> <span class="op">%&gt;%</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">V1</span><span class="op">/</span><span class="va">lam</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">V2</span><span class="op">/</span><span class="va">lam</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span>  <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">V1</span><span class="op">*</span><span class="va">scaling</span>, yend <span class="op">=</span> <span class="va">V2</span><span class="op">*</span><span class="va">scaling</span><span class="op">)</span>, 
               arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>,
               color <span class="op">=</span> <span class="st">"red"</span>,
               data <span class="op">=</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="va">rotation</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"PC1: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">ve</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"%"</span><span class="op">)</span>,
       y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"PC2: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">ve</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"%"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0.
## Using compatibility `.name_repair`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<div class="inline-figure"><img src="121-PCA_files/figure-html/unnamed-chunk-10-1.png" width="672"></div>
<p>If all you want is the scores and you don’t care about the scaling, you can just use <code>augment</code> and <code>ggplot</code>:</p>
<div class="sourceCode" id="cb267"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pca1</span> <span class="op">%&gt;%</span>
  <span class="fu">augment</span><span class="op">(</span><span class="va">cars</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">.fittedPC1</span>, y<span class="op">=</span> <span class="va">.fittedPC2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>   <span class="co"># divide by lam[1] and lam[2] to get the scaled version</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="121-PCA_files/figure-html/unnamed-chunk-11-1.png" width="672"></div>
<div id="second-example-penguins." class="section level3" number="21.1.1">
<h3>
<span class="header-section-number">21.1.1</span> Second example: penguins.<a class="anchor" aria-label="anchor" href="#second-example-penguins."><i class="fas fa-link"></i></a>
</h3>
<p>The palmer penguin data have 4 quantitative variables. We will scale them all to have mean 0 and standard deviation 1, since the units and magnitude of the numbers are not comparable. We will colour points by speices to make the patterns easier to see.</p>
<p><code>autoplot</code> has some quirks: the variable names must be quoted and colour must be spelled with a ‘u’. (Most <code>ggplot</code> functions allow for alternate spellings - color with and without a ‘u’, summarize with an ‘s’ instead of a ‘z’.) I don’t know of an easy way to use the <code>ggrepel</code> package with autoplot to avoid overprinting the text on the arrows or dots.</p>
<div class="sourceCode" id="cb268"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins_no_na</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span>
<span class="va">pca2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span><span class="va">penguins_no_na</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, <span class="va">body_mass_g</span>, <span class="va">bill_length_mm</span>, <span class="va">bill_depth_mm</span><span class="op">)</span>, scale<span class="op">=</span><span class="cn">TRUE</span> <span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">pca2</span>, data <span class="op">=</span> <span class="va">penguins_no_na</span>, loadings<span class="op">=</span><span class="cn">TRUE</span>, loadings.label<span class="op">=</span><span class="cn">TRUE</span>,
         colour<span class="op">=</span><span class="st">'species'</span>, shape<span class="op">=</span><span class="st">'island'</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="121-PCA_files/figure-html/unnamed-chunk-12-1.png" width="672"></div>
<p>Gentoo penguins are mostly distinguished by having the highest body mass. Adélie and Chinstrap penguins have similar masses, but are distinguished by dimensions of their bills and flippers. You can use <code>frame.type</code> to shade the areas containing
data from each species to highlight where the points are concentrated (by color).</p>
<div class="sourceCode" id="cb269"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">pca2</span>, data <span class="op">=</span> <span class="va">penguins_no_na</span>, loadings <span class="op">=</span> <span class="cn">TRUE</span>, loadings.label <span class="op">=</span> <span class="cn">TRUE</span>,
         colour <span class="op">=</span> <span class="st">'species'</span>, shape <span class="op">=</span> <span class="st">'island'</span>, 
         frame.type <span class="op">=</span> <span class="st">"norm"</span>, frame.level <span class="op">=</span> <span class="fl">0.90</span><span class="op">)</span>   <span class="co"># frame.type convex, norm, euclid, t; see ?ggbiplot</span></code></pre></div>
<div class="inline-figure"><img src="121-PCA_files/figure-html/unnamed-chunk-13-1.png" width="672"></div>
<p>Without a PCA, you could attempt to see these patterns by making a complex array of scatterplots for each pair of variables.</p>
<div class="sourceCode" id="cb270"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins_no_na</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, <span class="va">body_mass_g</span>, <span class="va">bill_length_mm</span>, <span class="va">bill_depth_mm</span>, <span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggpairs</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">species</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="121-PCA_files/figure-html/unnamed-chunk-14-1.png" width="672"></div>
<p>You should practice seeing how many of the pairwise differences in this pairs plot can be revealed in the single PCA.</p>
<p>Here is a customized ggplot of the PCA results. I simplifed the work in the first example by not using the conventional scaling; instead I just picked scales for the arrows that looked good. <strong>Need to fix this.</strong></p>
<div class="sourceCode" id="cb271"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rotation2</span> <span class="op">&lt;-</span> <span class="va">pca2</span> <span class="op">%&gt;%</span> 
  <span class="fu">tidy</span><span class="op">(</span>matrix <span class="op">=</span> <span class="st">"rotation"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">PC</span>, names_prefix <span class="op">=</span> <span class="st">"PC"</span>, values_from <span class="op">=</span> <span class="va">value</span><span class="op">)</span> 
<span class="va">pca2</span> <span class="op">%&gt;%</span>
  <span class="fu">augment</span><span class="op">(</span><span class="va">penguins_no_na</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.fittedPC1</span>, y <span class="op">=</span> <span class="va">.fittedPC2</span>, color <span class="op">=</span> <span class="va">species</span>, shape <span class="op">=</span> <span class="va">island</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rotation2</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="fl">3</span><span class="op">*</span><span class="va">PC1</span>, y <span class="op">=</span> <span class="fl">0</span>, yend <span class="op">=</span> <span class="fl">3</span><span class="op">*</span><span class="va">PC2</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span>,
               arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">20</span>, type <span class="op">=</span> <span class="st">"closed"</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_label_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rotation2</span>,
                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3</span><span class="op">*</span><span class="va">PC1</span>, y <span class="op">=</span> <span class="fl">3</span><span class="op">*</span><span class="va">PC2</span>, label <span class="op">=</span> <span class="va">column</span><span class="op">)</span>, 
                  color <span class="op">=</span> <span class="st">"darkblue"</span>, fill <span class="op">=</span> <span class="st">"#FFFFFF80"</span>,
                  arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">20</span>, type <span class="op">=</span> <span class="st">"closed"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"PC 1"</span>, y <span class="op">=</span> <span class="st">"PC 2"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="121-PCA_files/figure-html/unnamed-chunk-15-1.png" width="672"></div>
</div>
</div>
<div id="further-reading-15" class="section level2" number="21.2">
<h2>
<span class="header-section-number">21.2</span> Further reading<a class="anchor" aria-label="anchor" href="#further-reading-15"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Claus Wilke’s <a href="https://clauswilke.com/blog/2020/09/07/pca-tidyverse-style/">PCA tutorial</a>
</li>
<li><a href="https://bookdown.org/Maxine/r4ds/examples.html">Example PCA on iris data</a></li>
<li><a href="https://juliasilge.com/blog/stack-overflow-pca/" class="uri">https://juliasilge.com/blog/stack-overflow-pca/</a></li>
<li>PCA using <a href="https://juliasilge.com/blog/cocktail-recipes-umap/">tidymodels</a>
</li>
<li><a href="https://melinaluethje.com/2020/11/12/multivariate-ordinations-101/">PCA</a></li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="reproduce.html"><span class="header-section-number">20</span> Reproducible reports</a></div>
<div class="next"><a href="mds.html"><span class="header-section-number">22</span> Multidimensional scaling</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#pca"><span class="header-section-number">21</span> Principal component analysis</a></li>
<li>
<a class="nav-link" href="#example-1"><span class="header-section-number">21.1</span> Example</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#second-example-penguins."><span class="header-section-number">21.1.1</span> Second example: penguins.</a></li></ul>
</li>
<li><a class="nav-link" href="#further-reading-15"><span class="header-section-number">21.2</span> Further reading</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/AndrewIrwin/data-visualization/blob/master/121-PCA.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/AndrewIrwin/data-visualization/edit/master/121-PCA.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Visualization</strong>" was written by Andrew Irwin. It was last built on 2021-02-25.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
