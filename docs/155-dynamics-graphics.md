# Dynamic graphics {#dynamic}



In this short lesson I'll introduce two kinds of dynamic graphics. The first is a graphic that allows the reader to interact with the visualization. We've already seen 3d graphs that can be rotated, but you can also get information from hovering over data points. A second kind creates an animation to add another dimension (time) to the visualization. This can be helpful to "tell your story", but it can also be challenging to get the speed of the animation right and to describe it effectively to an audience. That's why Hans Rosling used his animation (way back in lesson 1) as part of an oral presentation.

## Reader interactions

Visualizations that are designed to respond to interactions (clicks, mouse movement) from the reader can show additional detail and provide opportunities for new ways of communication that are not possible with a static visualization. If you, as a creator of a visualization, require the reader to interact with your work to get the full meaning, you may find that your message is not communicated as effectively.

We will use the javascript plotly package, which is easily combined with ggplot graphics, to create some simple interactive visualizations.

## Example

The javascript package plot_ly can be used with R, both in Rstudio and in knitted HTML output. It automatically shows the coordinates of any point you aim your pointer at. It also provides the ability to pan and zoom the plot to focus in on part of the data. When you mouse is over the plot area, a menu appears at the top of the graph. Experiment with each control until you know what they all do.

plot_ly is a bit slow with a large dataset, so I'll use a subset of the diamonds data.


```r
diamonds %>% slice_sample(n = 1000) %>%
  plot_ly(x = ~ carat, 
          y = ~ price) %>%
  add_markers(color = ~ color)
```

```{=html}
<div id="htmlwidget-0b1f60919a836665ffcc" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-0b1f60919a836665ffcc">{"x":{"visdat":{"15396e5b2a6b":["function () ","plotlyVisDat"]},"cur_data":"15396e5b2a6b","attrs":{"15396e5b2a6b":{"x":{},"y":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"markers","color":{},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"carat"},"yaxis":{"domain":[0,1],"automargin":true,"title":"price"},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[0.44,2.11,0.3,0.67,1.21,0.3,2.28,1.31,1.19,0.9,1.15,2.5,2.01,1.24,0.32,0.34,1.57,0.3,1.57,1.06,1.01,2.23,1.05,0.32,1.16,1.14,0.72,0.91,1.5,0.82,0.7,1.59,1.52,2.01,1.22,2.02,1.25,1.2,0.99,0.74,0.61,1.11,1.04,0.72,0.77,1.21,1.51,2.11,1.75,1.14,2.1,1.12,1.51,0.4,0.83],"y":[694,15766,339,1581,4492,506,12755,6337,4761,3160,5152,15246,11188,4737,533,574,7737,394,7832,4517,3732,14867,4116,421,4702,3045,1846,3290,7308,2083,1767,8515,6367,12105,5042,12431,5500,4839,1901,1963,1692,3901,3407,2279,2005,4269,7991,12440,10619,4470,14359,4422,8203,591,2742],"type":"scatter","mode":"markers","name":"J","marker":{"color":"rgba(253,231,37,1)","line":{"color":"rgba(253,231,37,1)"}},"textfont":{"color":"rgba(253,231,37,1)"},"error_y":{"color":"rgba(253,231,37,1)"},"error_x":{"color":"rgba(253,231,37,1)"},"line":{"color":"rgba(253,231,37,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[0.71,1.33,1.18,1.52,1.52,1,0.9,1.61,2.1,1.2,0.3,1.04,2.07,1.11,0.27,1.57,1.58,0.84,1.5,0.6,0.78,1.01,1.52,2.17,1.59,1.53,1.23,1.08,1.24,0.9,1.51,2,1.1,1.26,2.01,0.36,1.36,0.5,0.31,1.51,1.21,1.2,1.19,0.54,0.35,0.33,1.01,1.01,0.3,0.51,0.71,0.41,0.41,1.07,1.24,0.9,1.54,0.31,1.5,0.36,0.4,0.3,1.7,0.31,0.89,2.03,0.3,0.32,0.3,0.7,0.33,1,2,1.32,2.04,1.67,1.23,1.01,1.23,1.31,0.35,0.4,0.71,0.71,1.31,1.48,1.54,0.3,0.38,1.22,0.27,0.32,0.4,1.52,1.51,0.33,0.85,2.01,1.22,1.18,0.32,0.44,2.04,2.01,0.3,0.73],"y":[2450,6963,5088,9067,8794,4032,2948,10236,10457,5257,394,3861,18359,4457,587,9478,10618,3201,8736,1295,2652,4525,8299,16716,11119,10171,7117,4476,6383,3644,9513,10976,4805,5398,16383,571,7592,1076,536,8836,7002,5408,4777,1170,945,594,4509,5478,615,1052,2525,863,539,4307,5714,3303,6375,544,8736,523,639,422,10662,408,2334,13063,391,391,438,2234,646,2875,15651,5588,8257,11400,7299,4263,6564,6573,620,842,2572,2428,6455,7086,10164,608,812,5960,412,523,982,9483,5750,579,3070,12985,5124,5378,554,807,17028,11954,473,2490],"type":"scatter","mode":"markers","name":"I","marker":{"color":"rgba(143,215,68,1)","line":{"color":"rgba(143,215,68,1)"}},"textfont":{"color":"rgba(143,215,68,1)"},"error_y":{"color":"rgba(143,215,68,1)"},"error_x":{"color":"rgba(143,215,68,1)"},"line":{"color":"rgba(143,215,68,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[0.3,0.52,0.43,0.31,1.23,1.5,0.39,1,0.35,1.31,0.73,0.7,0.89,1.23,0.41,1.53,1.08,0.7,0.7,0.39,1.56,0.9,1.16,1.03,1.19,0.27,1.14,0.9,2.13,1,0.5,0.9,2.38,0.72,0.72,0.49,1,1.13,0.33,1.52,1.52,1.12,0.91,0.42,1.28,0.83,1.21,1.09,0.91,1.03,0.31,1.17,0.32,0.7,0.33,1,0.3,1.5,0.31,0.71,0.32,0.31,0.38,1.01,0.31,2.21,2.06,1.07,0.6,1,1.53,0.3,0.41,0.72,0.32,1.13,0.31,0.3,0.52,1.22,1.21,1.05,1.14,0.34,1.24,1.75,0.36,0.71,1.27,0.3,0.53,0.41,1.14,1.2,0.72,1,0.3,0.3,0.66,0.91,1.21,1.16,0.33,0.32,1.06,1.24,0.71,0.9,0.71,1,1,1.2,0.41,1.01,0.53,0.33,0.33,2,0.26,0.92,1.2,0.93,1.62,0.78,0.32,1.76,0.34,1.23,1.7,1.02,0.7,0.9,2.52,1.24,1.06,0.31,2.13,0.9,0.25,0.56,1.2,0.62,0.3,1.41,1.25,1.24,1.01,1.25,0.57,0.92,2.1,1.5,1.12,1.04,0.35,0.7,1.06,2.12,0.57,1.01,0.9,0.31,0.32,0.53],"y":[675,1699,716,739,8541,10080,721,3920,504,8617,3785,2815,2610,5490,984,11557,5250,2088,2018,853,11922,3326,6084,4406,7277,527,5831,4428,15288,6133,1923,4155,18522,2198,2907,1588,4995,3603,827,11105,12764,4498,3924,1068,8645,2337,7426,5219,3423,3172,698,7644,720,2100,730,4930,764,11088,802,2498,720,907,1064,3971,464,13369,12931,5065,1679,3640,11982,590,991,3075,730,3669,573,630,1056,7506,7279,5323,4788,775,7210,7276,729,2188,7715,526,1712,1099,5858,3696,2376,4816,491,432,2178,4096,6180,4785,838,648,5520,6808,3014,4266,2076,4312,4514,6077,683,4432,1242,539,698,14199,474,3854,5746,3988,8865,2489,605,12361,672,6681,13681,3713,1995,5907,13846,7222,5020,513,13370,3878,426,1819,6666,2232,638,8283,5902,5055,4559,5740,1961,3417,16479,11360,5055,3611,788,2682,5048,18656,1728,4977,4234,628,708,1268],"type":"scatter","mode":"markers","name":"H","marker":{"color":"rgba(53,183,121,1)","line":{"color":"rgba(53,183,121,1)"}},"textfont":{"color":"rgba(53,183,121,1)"},"error_y":{"color":"rgba(53,183,121,1)"},"error_x":{"color":"rgba(53,183,121,1)"},"line":{"color":"rgba(53,183,121,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[0.41,1.01,0.42,1.59,1.05,0.56,0.58,2,0.55,1,0.54,1.06,0.33,0.34,1.38,0.31,0.58,0.31,0.37,0.6,1.1,1.02,0.38,2.07,0.9,1.04,1.51,0.98,0.4,0.51,0.9,0.38,0.7,0.42,0.71,0.7,1.52,0.3,1.51,1.5,0.72,1.51,1.43,1.08,1.51,1.28,0.5,1.34,1.2,0.4,0.79,0.51,0.71,0.7,0.7,1.21,1.1,0.73,1.37,0.36,0.7,1.32,2.05,1.05,0.31,0.56,0.5,0.31,0.71,0.53,1.03,1.01,0.4,0.32,0.42,0.32,0.74,0.51,0.72,0.91,0.32,1.55,0.7,0.36,1.54,1.1,1.07,1.51,0.39,0.3,1.28,0.33,1.23,1.01,0.33,0.28,0.41,1.52,1.03,0.59,1.34,0.31,0.66,0.56,0.51,1.22,0.31,1.28,0.51,0.7,0.53,1.16,0.44,0.5,0.5,0.32,0.32,0.9,0.43,0.5,1.2,0.32,0.52,0.5,0.32,1.14,0.45,0.72,0.31,0.9,0.52,1.21,1.55,1.01,0.9,0.29,1.01,0.35,0.3,2.03,1.05,0.37,0.34,0.4,0.51,1.5,0.7,1.23,0.9,0.3,0.7,0.71,0.3,0.55,1.01,0.27,0.47,1.04,0.41,0.52,0.44,1.06,0.54,0.45,1.05,0.61,0.35,1.05,0.37,0.45,0.3,2.11],"y":[1061,6618,687,9094,4857,1698,1343,10416,1645,4312,2080,4769,498,596,5487,625,1336,816,745,2485,7405,8042,855,17095,3787,5535,14616,3332,926,1833,2226,918,2302,1289,2264,3073,11105,565,13686,8820,2318,8973,10609,5559,10216,9342,1883,7780,5385,1051,2898,1825,2738,2593,2367,6559,6972,2708,10412,1074,3672,12094,15291,8623,544,1633,1197,698,2803,2051,5518,5131,1257,828,847,647,3495,1443,2383,4125,918,9530,2512,1053,8923,6653,6324,15420,912,725,8895,463,8145,7805,453,553,961,11014,4764,1431,9127,743,3051,2004,1859,6409,988,10537,1026,2268,1813,9526,1235,1897,1791,580,730,5148,1113,1806,6451,561,1244,1935,814,12458,1154,3478,544,2691,2238,7666,15794,5864,4077,607,7466,1103,1013,17393,7270,810,521,816,1974,12014,3127,10304,3649,776,2535,2240,789,2399,6126,566,1116,4742,1007,1577,1016,3321,1684,1105,9013,1668,1415,6070,649,1377,878,13598],"type":"scatter","mode":"markers","name":"G","marker":{"color":"rgba(33,144,140,1)","line":{"color":"rgba(33,144,140,1)"}},"textfont":{"color":"rgba(33,144,140,1)"},"error_y":{"color":"rgba(33,144,140,1)"},"error_x":{"color":"rgba(33,144,140,1)"},"line":{"color":"rgba(33,144,140,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1.01,0.35,0.3,0.32,0.36,0.7,0.7,0.52,0.6,0.5,0.51,0.37,1.32,0.31,0.55,0.74,0.52,1.63,0.31,0.32,0.3,0.31,0.41,0.52,0.41,0.54,1.25,0.41,1.52,0.92,0.59,0.41,1.19,0.32,1.24,0.31,0.82,1.04,0.52,1.01,0.31,0.41,0.31,0.8,0.83,1.51,1,0.45,0.37,0.41,0.4,0.39,0.72,0.91,1.45,0.7,0.41,0.51,0.33,0.51,0.57,0.3,0.25,0.46,1.51,0.37,0.32,1.07,0.59,0.33,0.4,0.31,0.3,0.51,1.04,0.78,0.36,0.36,1.51,1.02,0.91,0.74,0.5,1.01,0.51,0.41,0.39,0.45,0.77,1.13,0.71,0.7,0.91,1.66,1.01,1.04,0.36,0.52,0.4,1.5,0.9,0.8,1.01,0.24,0.73,1.02,1,1.24,1.03,0.26,1.16,0.31,1.14,0.27,1.21,0.73,0.79,0.57,0.29,0.41,1,0.81,0.32,0.83,0.7,0.53,0.24,0.9,1,1.07,1.22,1.01,0.3,1.01,1.26,0.3,0.33,0.38,0.3,0.41,0.32,0.73,0.31,0.3,1.04,0.31,1.01,1.22,1,0.9,0.34,0.42,0.41,1.51,0.43,1.03,0.41,0.31,1.01,0.5,0.71,0.9,0.52,0.31,1.51,0.34,0.37,0.35,0.41,0.92,0.72,0.53,0.99,0.3,0.31,0.7,0.7,0.59],"y":[4197,906,737,990,600,2552,2744,2333,2270,1250,1812,696,6660,625,2079,3170,1226,7229,663,874,1114,675,951,1550,1107,1745,8840,679,16055,3117,2000,1356,8415,702,5889,583,3453,4770,1778,6271,959,1107,749,3559,3010,11666,5221,1262,833,711,1145,1058,2784,3618,11667,2092,969,1421,810,1552,1847,496,430,815,11035,811,990,4573,2124,854,945,779,873,1632,6814,2923,932,770,15253,5222,4892,4336,1125,6244,2138,646,670,1012,2642,5481,3692,2401,3644,10338,4072,8090,600,1629,1049,15585,4617,3477,5309,393,2455,4455,4984,9930,5241,599,5164,625,4737,682,8452,1971,3806,1949,1776,1001,3146,3689,867,4417,3109,2802,552,4724,6899,4446,6132,6097,573,3563,10076,605,1028,1200,475,904,929,3135,921,814,4740,802,4049,9581,5929,3519,447,1223,749,11957,1016,6809,1107,1122,7745,2645,2559,6830,1778,815,8050,745,791,706,1107,4037,2229,1812,5112,814,874,1940,2264,1914],"type":"scatter","mode":"markers","name":"F","marker":{"color":"rgba(49,104,142,1)","line":{"color":"rgba(49,104,142,1)"}},"textfont":{"color":"rgba(49,104,142,1)"},"error_y":{"color":"rgba(49,104,142,1)"},"error_x":{"color":"rgba(49,104,142,1)"},"line":{"color":"rgba(49,104,142,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1.5,1.09,1,0.5,0.41,0.36,1.22,2.02,0.34,1.2,0.91,0.37,0.43,0.4,0.33,0.89,0.72,0.37,0.7,0.35,0.85,0.35,0.31,0.3,0.38,0.51,1.02,0.7,1.01,0.26,0.7,0.31,0.37,1.01,0.33,1.01,0.55,0.73,0.52,0.51,0.41,0.32,0.52,1.39,0.53,0.24,1.5,0.72,0.31,0.53,1.08,1.01,0.76,0.26,0.93,0.52,0.33,0.52,0.41,1.17,0.58,0.47,0.71,1,0.4,0.32,0.71,0.54,1.01,0.41,0.54,0.7,0.7,0.34,0.36,0.51,0.71,0.5,1.57,0.51,0.28,0.56,1.02,0.4,0.91,0.41,0.7,0.4,1.52,1.26,0.34,1.2,0.33,1,0.73,0.43,0.92,0.39,0.79,0.4,0.52,0.7,0.32,0.58,0.6,0.4,1.5,0.61,0.92,1.22,1.06,0.31,0.26,0.43,0.91,0.85,1.5,0.32,1.46,1,0.93,1,0.26,0.39,0.32,1.03,0.59,0.33,0.57,0.3,0.38,0.72,1.03,0.7,0.3,0.63,1.03,0.7,0.72,0.3,1.23,0.5,2,0.43,2.01,0.5,1.01,1.5,0.4,0.57,0.71,0.76,0.42,1.03,0.5,0.3,0.54,0.32,0.59,0.7,0.41,1.68,0.7,0.5,0.59,1.12,0.3,0.4,1.09,0.7,1.27,0.71,0.3,0.31,0.56,0.3,0.53,0.35,0.43,0.71,0.38,0.31,0.53,1,0.3,0.32,0.91,1.3,0.44],"y":[17667,6043,4026,1316,969,605,9475,17938,745,6006,3639,999,981,855,984,2728,3550,1041,2967,773,3803,853,636,837,1318,1781,5183,2513,4355,769,2032,942,811,4285,802,5590,1609,3310,1689,1812,969,860,1146,11248,1721,485,8167,2954,680,1830,7548,4434,2814,814,5992,2970,928,1767,1444,5163,1234,1294,3006,3575,666,638,3217,1754,6509,638,1765,2697,2476,1033,1013,1778,2704,1684,10362,1781,487,2304,11420,1125,3772,969,2614,1125,3105,10367,1071,8380,743,6445,2852,981,4258,1097,3796,1053,1343,2940,702,1758,1830,1053,10356,1721,3153,4974,12642,542,769,1131,4969,3167,8190,662,8421,5622,4739,9324,769,796,713,4441,1630,928,1807,421,1000,3304,5837,2656,814,2513,6344,3376,3223,675,6172,1154,16650,919,17676,840,5534,14592,694,1942,2735,2831,958,7817,1559,694,1847,900,2761,3585,1079,5765,2737,1331,1789,3864,622,882,5237,2777,11840,3760,943,680,1206,911,1813,718,1016,2711,1038,435,984,5061,911,954,4332,5751,987],"type":"scatter","mode":"markers","name":"E","marker":{"color":"rgba(68,58,131,1)","line":{"color":"rgba(68,58,131,1)"}},"textfont":{"color":"rgba(68,58,131,1)"},"error_y":{"color":"rgba(68,58,131,1)"},"error_x":{"color":"rgba(68,58,131,1)"},"line":{"color":"rgba(68,58,131,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[0.3,0.31,0.3,0.3,0.42,0.35,0.7,1,0.9,0.65,0.9,0.4,0.4,1.52,0.4,0.8,0.3,0.34,0.32,0.77,0.91,0.42,0.21,1.09,0.56,0.57,0.37,1.01,0.4,1.15,1.01,0.53,1,0.52,1.02,0.41,0.21,0.77,0.3,0.53,0.71,0.54,0.55,0.51,0.3,0.51,0.55,0.31,0.42,0.36,0.56,1.5,0.54,1.28,0.3,1.03,1,0.72,0.5,1.21,0.32,0.36,1.01,0.3,1,0.57,0.34,1.7,0.51,1.01,1.07,0.39,1.25,0.78,0.37,0.41,0.32,1.03,0.5,0.57,0.35,1.52,0.34,1.23,0.65,0.9,0.53,1.02,1,0.57,0.9,0.41,0.31,0.66,0.7,0.79,1.52,0.32,0.27,0.31,0.81,0.3,1.09,0.26,0.5,0.5,0.54,0.33,0.75,0.71,1.07,1.01,1.25,0.32,0.34,0.55,1,1.02,0.43,0.53,0.7,1.5,1.02,0.59,0.42,0.41,0.7,0.75,0.35,0.3,0.39,0.51,0.54,0.7,0.34,0.9],"y":[515,593,552,778,970,1167,2312,4218,3312,3025,3931,850,798,12707,1263,2708,710,803,589,3241,5342,784,386,5799,1723,4032,1108,7508,1050,4939,7422,1318,7146,1629,7389,1015,386,3160,742,2472,3252,1595,1990,1928,552,1752,1890,734,1040,689,1963,11442,2041,9548,574,7718,5342,2618,1333,5997,972,663,11082,670,5880,1387,805,11431,2718,4690,12545,702,7924,2430,1233,920,707,4764,1074,1847,522,11595,961,5689,4275,3534,1825,4558,6115,2122,3534,873,685,2079,2822,3185,9817,972,622,934,2926,426,5258,564,1235,1250,1892,781,3024,3716,4949,4672,9933,612,805,1401,16469,3838,858,2743,2318,6300,4381,2352,1235,744,3425,3696,1011,863,1024,1787,1892,3840,805,3871],"type":"scatter","mode":"markers","name":"D","marker":{"color":"rgba(68,1,84,1)","line":{"color":"rgba(68,1,84,1)"}},"textfont":{"color":"rgba(68,1,84,1)"},"error_y":{"color":"rgba(68,1,84,1)"},"error_x":{"color":"rgba(68,1,84,1)"},"line":{"color":"rgba(68,1,84,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
```

Plot_ly can do a lot more than this example shows, including animation. There is a lot of documentation you can find at the link under Further Reading.

## Animations

Let's recreate a version of Rosling's plot of life expectancy as a function of income over time.

First we'll make the plot for just one year. Then we will animate the plot changing year over time in the animation.


```r
gapminder %>% 
  filter(year == 1957) %>%
  ggplot() +
  geom_text(aes(label = min(year)), x = 3.8, y = 50, size = 40, color = "lightgray") +
  geom_point(aes(x = gdpPercap,
             y = lifeExp,
             size = pop,
             color = continent)) +
  theme_bw() +
  scale_x_log10()
```

<img src="155-dynamics-graphics_files/figure-html/unnamed-chunk-2-1.png" width="672" />

Now we will use functions from the `gganimate` package to change year from one frame to the next. Here we use `transition_state` to change the plot along values of `year`. The animation is produced with just one function: `transition_time(year)` which uses the quantitative value of year to control the display of data over time. The code to show the year in the `geom_text` is not at all obvious.


```r
animation <- gapminder %>% 
  ggplot() +
  geom_text(aes(label = format(round(year))), 
            x = 3.8, y = 50, 
            size = 40, color = "lightgray") +
  geom_point(aes(x = gdpPercap,
             y = lifeExp,
             size = pop,
             color = continent)) +
  theme_bw() +
  scale_x_log10() +
  transition_time(year) +
  labs(title = "Animation frame {frame} of {nframes}")
animate(animation, nframes = 75)
```

![](155-dynamics-graphics_files/figure-html/unnamed-chunk-3-1.gif)<!-- -->

## Further reading

* Documentation for [plot_ly](https://plotly.com/r/) graphics for R
* Documentation for [gganimate](https://gganimate.com/index.html), the grammar of animations
