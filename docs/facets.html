<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 10 Facetted graphs | Data Visualization</title>
<meta name="author" content="Andrew Irwin">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6.4/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Visualization</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="syllabus.html">Syllabus</a></li>
<li><a class="" href="outline.html">Detailed outline</a></li>
<li><a class="" href="sync.html">Synchronous meeting agendas</a></li>
<li><a class="" href="evaluation.html">Evaluation</a></li>
<li><a class="" href="ch-invitation.html"><span class="header-section-number">1</span> Invitation to Data Visualization</a></li>
<li><a class="" href="ch-tools.html"><span class="header-section-number">2</span> Computer tools</a></li>
<li><a class="" href="setup.html"><span class="header-section-number">3</span> Setting up your computer</a></li>
<li><a class="" href="look-data.html"><span class="header-section-number">4</span> Look at Data</a></li>
<li><a class="" href="first-plot.html"><span class="header-section-number">5</span> Making your first plot</a></li>
<li><a class="" href="vcs.html"><span class="header-section-number">6</span> What is version control software?</a></li>
<li><a class="" href="grammar.html"><span class="header-section-number">7</span> Grammar of Graphics</a></li>
<li><a class="" href="ggplot.html"><span class="header-section-number">8</span> Using the grammar of graphics</a></li>
<li><a class="" href="summarizing-data.html"><span class="header-section-number">9</span> Summarizing data</a></li>
<li><a class="active" href="facets.html"><span class="header-section-number">10</span> Facetted graphs</a></li>
<li><a class="" href="reading-data.html"><span class="header-section-number">11</span> Reading data</a></li>
<li><a class="" href="pivot.html"><span class="header-section-number">12</span> Reshaping data</a></li>
<li><a class="" href="format-tables.html"><span class="header-section-number">13</span> Format tables</a></li>
<li><a class="" href="help.html"><span class="header-section-number">14</span> Getting help and asking questions</a></li>
<li><a class="" href="working-models.html"><span class="header-section-number">15</span> Working with models</a></li>
<li><a class="" href="linear-models.html"><span class="header-section-number">16</span> Linear models</a></li>
<li><a class="" href="smoothing.html"><span class="header-section-number">17</span> GAM and LOESS smoothing</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">18</span> Collaborating with GitHub</a></li>
<li><a class="" href="data-sources.html"><span class="header-section-number">19</span> Finding and accessing data</a></li>
<li><a class="" href="reproduce.html"><span class="header-section-number">20</span> Reproducible reports</a></li>
<li><a class="" href="pca.html"><span class="header-section-number">21</span> Principal component analysis</a></li>
<li><a class="" href="mds.html"><span class="header-section-number">22</span> Multidimensional scaling</a></li>
<li><a class="" href="k-means.html"><span class="header-section-number">23</span> K-means clustering</a></li>
<li><a class="" href="slides.html"><span class="header-section-number">24</span> Making slides for presentations</a></li>
<li><a class="" href="factors-dates.html"><span class="header-section-number">25</span> Working with factors and dates</a></li>
<li><a class="" href="colour.html"><span class="header-section-number">26</span> Using colour well</a></li>
<li><a class="" href="theme.html"><span class="header-section-number">27</span> Themes</a></li>
<li><a class="" href="output-files.html"><span class="header-section-number">28</span> Graphics formatting</a></li>
<li><a class="" href="organization.html"><span class="header-section-number">29</span> Staying organized</a></li>
<li><a class="" href="r-details.html"><span class="header-section-number">30</span> More details about R</a></li>
<li><a class="" href="accessibility-bias-and-ethics.html"><span class="header-section-number">31</span> Accessibility, Bias, and Ethics</a></li>
<li><a class="" href="metadata.html">Metadata</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/AndrewIrwin/data-visualization">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="facets" class="section level1" number="10">
<h1>
<span class="header-section-number">10</span> Facetted graphs<a class="anchor" aria-label="anchor" href="#facets"><i class="fas fa-link"></i></a>
</h1>
<p>When a plot has too much data, or you want to emphasize a particular comparison across categories or numerical values, it is often a good idea to split the graph into several subplots. Like any method, this can be overdone, for example by producing a complex array of too many plots that distract and confuse the reader. Done well, the multiple plots let patterns jump off the page.</p>
<p>Making a sequence or array of similar plots goes by a variety of names: small multiples, a lattice, or facets. We’ll call them facets because that’s the name ggplot uses.</p>
<p>Facetted plots are often useful with datasets that have one or more categorical variables and lots of observations. We’ll use the <code>diamonds</code> dataset because, as we’ve seen, variation across . Let’s start by using <code>glimpse</code> to see what’s there.</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">glimpse</span><span class="op">(</span><span class="va">diamonds</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 53,940
## Columns: 10
## $ carat   &lt;dbl&gt; 0.23, 0.21, 0.23, 0.29, 0.31, 0.24, 0.24, 0.26, 0.22, 0.23, 0…
## $ cut     &lt;ord&gt; Ideal, Premium, Good, Premium, Good, Very Good, Very Good, Ve…
## $ color   &lt;ord&gt; E, E, E, I, J, J, I, H, E, H, J, J, F, J, E, E, I, J, J, J, I…
## $ clarity &lt;ord&gt; SI2, SI1, VS1, VS2, SI2, VVS2, VVS1, SI1, VS2, VS1, SI1, VS1,…
## $ depth   &lt;dbl&gt; 61.5, 59.8, 56.9, 62.4, 63.3, 62.8, 62.3, 61.9, 65.1, 59.4, 6…
## $ table   &lt;dbl&gt; 55, 61, 65, 58, 58, 57, 57, 55, 61, 61, 55, 56, 61, 54, 62, 5…
## $ price   &lt;int&gt; 326, 326, 327, 334, 335, 336, 336, 337, 337, 338, 339, 340, 3…
## $ x       &lt;dbl&gt; 3.95, 3.89, 4.05, 4.20, 4.34, 3.94, 3.95, 4.07, 3.87, 4.00, 4…
## $ y       &lt;dbl&gt; 3.98, 3.84, 4.07, 4.23, 4.35, 3.96, 3.98, 4.11, 3.78, 4.05, 4…
## $ z       &lt;dbl&gt; 2.43, 2.31, 2.31, 2.63, 2.75, 2.48, 2.47, 2.53, 2.49, 2.39, 2…</code></pre>
<p>As a consequence of years of relentless advertising, you may be aware of four widely reported characteristics of diamonds that influence their price: cut, colour, clarity, and carats. Let’s make a plot of price vs carets (mass) showing all the data. Since there are so many points, we will make each point smaller.</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">carat</span>, y<span class="op">=</span><span class="va">price</span>, color<span class="op">=</span><span class="va">cut</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span>
<span class="va">p1</span></code></pre></div>
<div class="inline-figure">
<img src="115-facets_files/figure-html/unnamed-chunk-3-1.png" width="672">
## Facets indexed by one variable</div>
<p>If you want to display many levels of a categorical variable across many facets, the <code>facet_wrap</code> function is available. We’ll do this here for just one colour using <code>filter</code> to select it. The <code>facet_wrap</code> function requires you to give a “formula” for how the facets are constructed. Here we write <code>~ clarity</code> meaning that the levels of the categorical variable <code>clarity</code> is used to facets. One facet is drawn for each value of the variable and only points with that value of clarity are shown on the corresponding facet.</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">color</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"F"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">carat</span>, y<span class="op">=</span><span class="va">price</span>, color<span class="op">=</span><span class="va">cut</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">clarity</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="115-facets_files/figure-html/unnamed-chunk-4-1.png" width="672"></div>
<p>Notice that the x and y scales are the same on each facet. A single colour scale is used for <code>cut</code> and this is the same for each facet as well. We can see that there is a similar non-linear relationship between price and carat on each panel. The price is higher at any particular size (carat) in the panels near the bottom compared to the panels near the top. Cut makes a compartively small difference to the price.</p>
<div id="facets-indexed-by-two-variables" class="section level2" number="10.1">
<h2>
<span class="header-section-number">10.1</span> Facets indexed by two variables<a class="anchor" aria-label="anchor" href="#facets-indexed-by-two-variables"><i class="fas fa-link"></i></a>
</h2>
<p>If you want to look at the effect of two categorical variables across different facets, you can arrange them in a grid. Again we use a formula, but now we put the variables for the “y” axis of facets on the left side of <code><a href="https://rdrr.io/r/base/tilde.html">~</a></code> and the variables determining the <code>x</code> axis of the facets on the right.</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">color</span> <span class="op">~</span> <span class="va">clarity</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="115-facets_files/figure-html/unnamed-chunk-5-1.png" width="672"></div>
<p>The plots in those facets are really small. Let’s pick out just a few colours and clarity values to make a plot that is easier to read.</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">color</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"D"</span>, <span class="st">"F"</span>, <span class="st">"H"</span>, <span class="st">"J"</span><span class="op">)</span>, 
         <span class="va">clarity</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SI1"</span>, <span class="st">"VS1"</span>, <span class="st">"IF"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">carat</span>, y<span class="op">=</span><span class="va">price</span>, color<span class="op">=</span><span class="va">cut</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">color</span> <span class="op">~</span> <span class="va">clarity</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_colour_viridis_d</a></span><span class="op">(</span>begin<span class="op">=</span><span class="fl">0</span>, end <span class="op">=</span><span class="fl">0.8</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="115-facets_files/figure-html/unnamed-chunk-6-1.png" width="672"></div>
</div>
<div id="compositing" class="section level2" number="10.2">
<h2>
<span class="header-section-number">10.2</span> Compositing<a class="anchor" aria-label="anchor" href="#compositing"><i class="fas fa-link"></i></a>
</h2>
<p>If you want to combine graphs together into a grid layout, but the graphs don’t share axes or even data, then it may be easier to draw the graphs separately and then combine them together into a layout with the <code>patchwork</code> package. This package is both simple to use and quite powerful, enabling complex layouts, labelling subplots with codes to aid identification, and combining guides for colours and shapes across panels. The <a href="https://patchwork.data-imaginist.com/">documentation</a> is excellent.</p>
<p>Here is an example showing two plots with very different views of the <code>gapminder</code> data. It’s usually best to create the plots one at a time, assign them to a name in your R environment using <code><a href="https://rdrr.io/r/base/assignOps.html">&lt;-</a></code> and a name for each plot, then put them together using <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> from the <code>patchwork</code> package.</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">count</span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">continent</span>, y <span class="op">=</span> <span class="va">n</span>, fill<span class="op">=</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Number of countries"</span><span class="op">)</span> 
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span>, color <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span> </code></pre></div>
<div class="inline-figure"><img src="115-facets_files/figure-html/unnamed-chunk-7-1.png" width="672"></div>
<p>You can make complex layouts, collect legends from multiple panels together, and label panels with patchwork. Read the documentation if you want to learn more.</p>
</div>
<div id="further-reading-6" class="section level2" number="10.3">
<h2>
<span class="header-section-number">10.3</span> Further reading<a class="anchor" aria-label="anchor" href="#further-reading-6"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>The <a href="https://ggplot2-book.org/facet.html">ggplot book</a> has a longer tutorial on using facets.</li>
<li>The <a href="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/">R cookbook</a> has more examples of facetted plots, including instructions for chaging the way the facets are labelled.</li>
<li>The <a href="https://patchwork.data-imaginist.com/">patchwork</a> documentation can help you with many more tasks.</li>
<li>The <a href="https://cran.r-project.org/web/packages/cowplot/vignettes/introduction.html#:~:text=The%20cowplot%20package%20is%20a,or%20mix%20plots%20with%20images.">cowplot</a> package package is designed to help with many plotting tasks, including combining many figures into one using <code>plot_grid</code>. “cow” stands for Claus O Wilke, the author of one of our textbooks.</li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="summarizing-data.html"><span class="header-section-number">9</span> Summarizing data</a></div>
<div class="next"><a href="reading-data.html"><span class="header-section-number">11</span> Reading data</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#facets"><span class="header-section-number">10</span> Facetted graphs</a></li>
<li><a class="nav-link" href="#facets-indexed-by-two-variables"><span class="header-section-number">10.1</span> Facets indexed by two variables</a></li>
<li><a class="nav-link" href="#compositing"><span class="header-section-number">10.2</span> Compositing</a></li>
<li><a class="nav-link" href="#further-reading-6"><span class="header-section-number">10.3</span> Further reading</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/AndrewIrwin/data-visualization/blob/master/115-facets.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/AndrewIrwin/data-visualization/edit/master/115-facets.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Visualization</strong>" was written by Andrew Irwin. It was last built on 2021-02-19.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
