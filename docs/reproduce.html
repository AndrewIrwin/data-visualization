<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 20 Reproducible reports | Data Visualization</title>
<meta name="author" content="Andrew Irwin">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.7/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4/tabs.js"></script><script src="libs/bs3compat-0.2.4/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><script src="libs/plotly-binding-4.9.3/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Visualization</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="syllabus.html">Syllabus</a></li>
<li><a class="" href="outline.html">Detailed outline</a></li>
<li><a class="" href="sync.html">Synchronous meeting agendas</a></li>
<li><a class="" href="evaluation.html">Evaluation</a></li>
<li><a class="" href="ch-invitation.html"><span class="header-section-number">1</span> Invitation to Data Visualization</a></li>
<li><a class="" href="ch-tools.html"><span class="header-section-number">2</span> Computer tools</a></li>
<li><a class="" href="setup.html"><span class="header-section-number">3</span> Setting up your computer</a></li>
<li><a class="" href="look-data.html"><span class="header-section-number">4</span> Look at Data</a></li>
<li><a class="" href="first-plot.html"><span class="header-section-number">5</span> Making your first plot</a></li>
<li><a class="" href="vcs.html"><span class="header-section-number">6</span> What is version control software?</a></li>
<li><a class="" href="grammar.html"><span class="header-section-number">7</span> Grammar of Graphics</a></li>
<li><a class="" href="ggplot.html"><span class="header-section-number">8</span> Using the grammar of graphics</a></li>
<li><a class="" href="summarizing-data.html"><span class="header-section-number">9</span> Summarizing data</a></li>
<li><a class="" href="facets.html"><span class="header-section-number">10</span> Facetted graphs</a></li>
<li><a class="" href="reading-data.html"><span class="header-section-number">11</span> Reading data</a></li>
<li><a class="" href="pivot.html"><span class="header-section-number">12</span> Reshaping data</a></li>
<li><a class="" href="format-tables.html"><span class="header-section-number">13</span> Format tables</a></li>
<li><a class="" href="help.html"><span class="header-section-number">14</span> Getting help and asking questions</a></li>
<li><a class="" href="working-models.html"><span class="header-section-number">15</span> Working with models</a></li>
<li><a class="" href="linear-models.html"><span class="header-section-number">16</span> Linear models</a></li>
<li><a class="" href="smoothing.html"><span class="header-section-number">17</span> GAM and LOESS smoothing</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">18</span> Collaborating with GitHub</a></li>
<li><a class="" href="data-sources.html"><span class="header-section-number">19</span> Finding and accessing data</a></li>
<li><a class="active" href="reproduce.html"><span class="header-section-number">20</span> Reproducible reports</a></li>
<li><a class="" href="pca.html"><span class="header-section-number">21</span> Principal component analysis</a></li>
<li><a class="" href="mds.html"><span class="header-section-number">22</span> Multidimensional scaling</a></li>
<li><a class="" href="k-means.html"><span class="header-section-number">23</span> K-means clustering</a></li>
<li><a class="" href="slides.html"><span class="header-section-number">24</span> Making slides for presentations</a></li>
<li><a class="" href="testing.html"><span class="header-section-number">25</span> Checking your work</a></li>
<li><a class="" href="dynamic.html"><span class="header-section-number">26</span> Dynamic graphics</a></li>
<li><a class="" href="mapping-1.html"><span class="header-section-number">27</span> Making maps</a></li>
<li><a class="" href="mapping-2.html"><span class="header-section-number">28</span> Mapping part two</a></li>
<li><a class="" href="mapping-3.html"><span class="header-section-number">29</span> Alternatives to maps</a></li>
<li><a class="" href="factors-dates.html"><span class="header-section-number">30</span> Working with factors and dates</a></li>
<li><a class="" href="colour.html"><span class="header-section-number">31</span> Using colour well</a></li>
<li><a class="" href="theme.html"><span class="header-section-number">32</span> Themes</a></li>
<li><a class="" href="output-files.html"><span class="header-section-number">33</span> Graphics formatting</a></li>
<li><a class="" href="organization.html"><span class="header-section-number">34</span> Staying organized</a></li>
<li><a class="" href="r-details.html"><span class="header-section-number">35</span> More details about R</a></li>
<li><a class="" href="accessibility-bias-and-ethics.html"><span class="header-section-number">36</span> Accessibility, Bias, and Ethics</a></li>
<li><a class="" href="metadata.html">Metadata</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/AndrewIrwin/data-visualization">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="reproduce" class="section level1" number="20">
<h1>
<span class="header-section-number">20</span> Reproducible reports<a class="anchor" aria-label="anchor" href="#reproduce"><i class="fas fa-link"></i></a>
</h1>
<p>We’ve seen throughout the course how to combine computer code, data, tabular and graphical resultss, and natural language writing to explain and communicate our work. R markdown documents are a great tool for writing reports and ensuring they are reproducible. In this lesson we will examine a few more features of R markdown to help customize your reports, make them easier to revise, and make them more effective data analysis communication tools.</p>
<div id="what-is-reproducibility-and-why-should-i-care" class="section level2" number="20.1">
<h2>
<span class="header-section-number">20.1</span> What is reproducibility and why should I care?<a class="anchor" aria-label="anchor" href="#what-is-reproducibility-and-why-should-i-care"><i class="fas fa-link"></i></a>
</h2>
<p>Many people use R as an interactive computer tool. This means they sit at the keyboard, type a series of commands, and store the results they want. It’s like a very fancy calculator. This is a fantastic way to explore data, learn R, and test out ideas quickly. This work is not reproducible. You would need a recording of everything that was done to reproduce the analysis. If you need to change a small step in your work, you will need to repeat all the steps.</p>
<p>In this course, we have been using R in a slightly more disciplined way, at least for assigned work. For every project, you create a new R markdown file, and then you write your computer instructions in code “chunks”, interspersed with English (or any other natural human language) explanations. With Rstudio, you can still use R interactively in this mode, clicking the “play” button on each chunk and seeing the output. When your analysis is done, you can “knit” the whole document. This does two important things:</p>
<ul>
<li>all the code is executed in order from top to bottom, and</li>
<li>the results are kept in a new file.</li>
</ul>
<p>You may have had the experience during the course of preparing your R markdown file, trying to knit it, and discovering an error. This error is evidence that your R markdown document is not complete, so if you rely on it, you will not be able to repeat your steps later on. So the first way R markdown aids you in reproducing your work is by giving you an easy way to test if your instructions are complete. If you can knit your file today, you can turn off your computer, and come back in a week, and be confident you will be able to reproduce your work then.</p>
<p>We have stressed the value of communication in this course. For some purposes you will just want to communicate by sending someone your knitted report. When you work in a team, communication is not just about the knitted report, but it includes the instructions needed to recreate the report. R markdown is great for this. But most analyses will require more than just one R markdown file. They will require data. This is why we have also learned to use R projects, version control, and to share files using GitHub. Now you can write a document to show someone else how to reproduce your work, from gathering data to making a report, and you can be confident that they will be able to make all the steps work and even add to your work in a time-efficient way.</p>
</div>
<div id="what-are-barriers-to-reproducibility-and-how-i-can-overcome-them" class="section level2" number="20.2">
<h2>
<span class="header-section-number">20.2</span> What are barriers to reproducibility and how I can overcome them?<a class="anchor" aria-label="anchor" href="#what-are-barriers-to-reproducibility-and-how-i-can-overcome-them"><i class="fas fa-link"></i></a>
</h2>
<div id="file-paths" class="section level3" number="20.2.1">
<h3>
<span class="header-section-number">20.2.1</span> File paths<a class="anchor" aria-label="anchor" href="#file-paths"><i class="fas fa-link"></i></a>
</h3>
<p>If you have a complex project, you will have multiple directories, and possibly many data files. When reading a data file, you will need to refer to the file by name. Make sure you never use the way files are organized on your computer as part of the script. In particular never write anything like:</p>
<pre><code>my_data &lt;- read_csv("/Users/airwin/Documents/Stats-project/data/my_data.csv")</code></pre>
<p>because there is no way that will work on someone else’s computer! If you reorganize your Documents folder, it won’t even work on your computer! What should you do instead?</p>
<p>We have been using R packages and organizing all files for a project in a folder (and sub-folders) created just for that project. This is a good first step. The <code>here</code> package provides a useful function that allows you refer to a file relative to the directory where your <code>.Rproj</code> file is stored. This is <a href="https://malco.io/2018/11/05/why-should-i-use-the-here-package-when-i-m-already-using-projects/">important</a> to make your R code work on someone else’s computer. Here’s how you use it:</p>
<pre><code>my_data &lt;- read_csv(here("static", "annual-number-of-deaths-by-cause.csv"))</code></pre>
<p>If this code works on your computer, with your R project, and you give the whole folder to a collaborator, you don’t need to worry how they organize their files.</p>
<p>Sometimes you will think a dataset is too large to put in your project folder. Or the data may be used by multiple projects, and you don’t want to have multiple copies. What should you do? The best options are: put the common data files in a GitHub repository (public or private), deposit the data in an online repository such as <a href="https://osf.io/">osf.io</a>, or create an <a href="https://r-pkgs.org/data.html">R data package</a> of your own to manage the data on your computer and the computers of your collaborators. Which method you prefer will depend on many factors including the size of the data, how often it changes, whether it is public, or if you are allowed to redistribute it.</p>
</div>
<div id="caching-time-consuming-computations" class="section level3" number="20.2.2">
<h3>
<span class="header-section-number">20.2.2</span> Caching time-consuming computations<a class="anchor" aria-label="anchor" href="#caching-time-consuming-computations"><i class="fas fa-link"></i></a>
</h3>
<p>R markdown is a great way to manage a analysis notebook, but every time you want to update your analysis, you need to recalculate everything in your document. It is possible to store (cache) the results of a code chunk by giving it a name and setting <code>cache=TRUE</code>. This will store the results of that computation so that when the markdown file is recomputed, the stored results are used. This can save time, but also lead to unpredictable results depending on how the results of one code chunk and external data influence the cached code chunk.</p>
<p>Here is an example using the code chunk header <code>{r test_caching, cache=TRUE}</code>:</p>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu">summarize</span><span class="op">(</span><span class="va">mpg</span>, count <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> 
<span class="va">s1</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   count
##   &lt;int&gt;
## 1   234</code></pre>
<p>If you are going to use this feature, you should read more about <a href="https://bookdown.org/yihui/rmarkdown-cookbook/cache.html">caching in Rmarkdown</a>. This page describes a do-it-yourself caching method which I recommend as well.</p>
</div>
<div id="finding-and-installing-r-packages" class="section level3" number="20.2.3">
<h3>
<span class="header-section-number">20.2.3</span> Finding and installing R packages<a class="anchor" aria-label="anchor" href="#finding-and-installing-r-packages"><i class="fas fa-link"></i></a>
</h3>
<p>R packages can be obtained from several sources. The most common sources are <a href="https://cran.r-project.org/">CRAN</a>, <a href="http://www.bioconductor.org/">Bioconductor</a>, and GitHub. The most widely used packages are on CRAN and they are checked regularly to be sure they still work. Anyone can distribute a package on GitHub and make it available, but these packages are missing a level of quality control. We have not used Bioconductor in this course; it is a CRAN-like repository forcussed on bioinformatics computations.</p>
<p>Installing a new package from CRAN is easy. If you put the appropriate <code>library</code> function call in your R markdown document, but you are missing the package, Rstudio will offer to download it for you. If the package is on GitHub, Rstudio won’t be able to help. The usual process is to search for the package on Google, then install it. You will help yourself and your colleagues if you write the installation command next to your <code>library</code> function call, but preface it with a comment character <code>#</code> to stop the code from being executed. (There is an example at the top of the source for this file: click on “view source” in the lower right of this window.)</p>
</div>
</div>
<div id="make-your-report-look-good" class="section level2" number="20.3">
<h2>
<span class="header-section-number">20.3</span> Make your report look good<a class="anchor" aria-label="anchor" href="#make-your-report-look-good"><i class="fas fa-link"></i></a>
</h2>
<p>An easy to read report is a better report. (Formatting will not turn a bad report into a good one, but good formatting can help make good results easier to digest.)</p>
<p>Specific recommendations:</p>
<ul>
<li>Use headings (lines starting with one or more <code>#</code>.) Always put a blank line before and after a heading row.</li>
<li>Use bulletted or numbered lists (start a seqeunce of lines with a <code><a href="https://rdrr.io/r/base/Arithmetic.html">*</a></code> or <code>1.</code>) when appropriate</li>
<li>Format your code nicely. Use a <a href="https://style.tidyverse.org/">style guide</a>. Or use an automatic code formatter such as styler (see below). Leave a blank line before and after your code chunk blocks.</li>
<li>Format your output nicely. This includes tables and figures. (See below.)</li>
<li>knit your report, read the formatted version, revise the markdown source, and repeat.</li>
</ul>
<p>For examples of these formatting tips, see the source for this file: click on “view source” in the lower right of this window.</p>
<p>Headings make your markdown document easier to navigate too. Look for the “show outline” button in the upper right of Rstudio’s editing pane.</p>
</div>
<div id="code-formatting" class="section level2" number="20.4">
<h2>
<span class="header-section-number">20.4</span> Code formatting<a class="anchor" aria-label="anchor" href="#code-formatting"><i class="fas fa-link"></i></a>
</h2>
<p>There is a <a href="https://style.tidyverse.org/">tidyverse style guide</a>. Google has their <a href="https://google.github.io/styleguide/Rguide.html">own</a>, revised from the tidyverse guide. It’s worthwhile reading these guides. Code that is formatted in a standard way is easier for you to read and easier for someone else to read.</p>
<p>Here is some carelessly formatted code.</p>
<pre><code>gapminder %&gt;% filter(continent =="Europe") %&gt;% group_by(country) %&gt;% summarize(mean_life_exp = mean(lifeExp), mean_GDP = mean(gdpPercap)) %&gt;% ggplot(
aes(color = mean_life_exp, x = log10(mean_GDP), y=fct_reorder(country, mean_life_exp))) + geom_point()</code></pre>
<p>Here is the same code (and its output) formatted using <code>styler</code>:</p>
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Europe"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarize</span><span class="op">(</span>mean_life_exp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>, mean_GDP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">mean_life_exp</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">mean_GDP</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">country</span>, <span class="va">mean_life_exp</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="133-reproducible-reports_files/figure-html/unnamed-chunk-1-1.png" width="672"></div>
<p>I suggest you write neat and easy to read code in your markdown documents. Don’t use automatic tidying as an excuse to make messy code.</p>
</div>
<div id="customization-of-result-reporting-in-r-markdown" class="section level2" number="20.5">
<h2>
<span class="header-section-number">20.5</span> Customization of result reporting in R markdown<a class="anchor" aria-label="anchor" href="#customization-of-result-reporting-in-r-markdown"><i class="fas fa-link"></i></a>
</h2>
<p>The first line of a code chunk can be as simple as <code>{r}</code> but you can also include many options between the braces. The <a href="https://bookdown.org/yihui/rmarkdown-cookbook/chunk-options.html">markdown book</a> describes the options available. Here I will demonstrate a few chunk options related to figures and formatting output.</p>
<p>Knitting a document usually stops when an error is encountered. This is a safety measure to alert you to a document which is not reproducible becuase of errors. On rare occasions you may want to use the option <code>error=TRUE</code> to allow error messages to appear in knitted output and not stop the knitting process.</p>
<div class="sourceCode" id="cb231"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fl">1</span> <span class="op">+</span> <span class="st">"A"</span></code></pre></div>
<pre><code>## Error in 1 + "A": non-numeric argument to binary operator</code></pre>
<p>You can output graphics in multiple file formats by adding <code>dev = c("png", "pdf")</code> (and other formats) to the chunk options. These files will be deleted unless you <a href="https://bookdown.org/yihui/rmarkdown-cookbook/keep-files.html#keep-files">reqest they be kept</a>, which is easily done by caching the results of at least one code chunk.</p>
<div class="sourceCode" id="cb233"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">displ</span>, <span class="va">hwy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="133-reproducible-reports_files/figure-html/cache_test_2-1.png" width="672"></div>
<p>You can use chunk options to control whether the knitted document includes:</p>
<ul>
<li>code (<code>echo=FALSE</code> to hide)</li>
<li>results (<code>results='hide'</code>)</li>
<li>messages (<code>message=FALSE</code> to hide)</li>
<li>warnings (<code>warning=FALSE</code> to hide)</li>
<li>plots (<code>fig.show='hide'</code>)</li>
<li>everything (<code>include=FALSE</code>)</li>
</ul>
<p>You can also stop the code from being evaluated by setting <code>eval=FALSE</code>.</p>
<p>If you have multiple lines of code with output in your chunk, the knitted document will contain several blocks of code and output with space between the blocks. These blocks can be combined into one by setting <code>collapse=TRUE</code>.</p>
<p>R code that is formatted in standardized way is easier for others to read. You can get your code automatically reformatted using <code>tidy=TRUE</code> and the <code>formatR</code> package. The <code>styler</code> package is another approach to automatic reformatting of R code. Use <code>tidy='styler'</code> in the code chunk options.</p>
<p>You can change the size of a figure using <code>fig.width = 6</code> and <code>fig.height=4</code> where 6 and 4 are lengths in inches. You can also use <code>out.width="85%"</code> to set the width of the figure as a proportion of the document width. You can center a figure horizontally using <code>fig.align='center'</code>.</p>
<p>You can use R <a href="https://bookdown.org/yihui/rmarkdown-cookbook/chunk-variable.html">variables and code</a> in the chunk options.</p>
</div>
<div id="documenting-which-packages-you-use" class="section level2" number="20.6">
<h2>
<span class="header-section-number">20.6</span> Documenting which packages you use<a class="anchor" aria-label="anchor" href="#documenting-which-packages-you-use"><i class="fas fa-link"></i></a>
</h2>
<p>If you use R for long enough and with enough other people, you will discover that R packages get revised and don’t always work the same way as they used to. This can be a major impediment to reproducibility. The simplest solution to this problem is to document the R packages you use in your analysis by adding a line of code to the end of your report that lists the packages and their version numbers in use. By looking at your knitted output, a user having trouble (possibly you in the future!) can look to see which packages have changed.</p>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## R version 4.0.3 (2020-10-10)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Mojave 10.14.6
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_CA.UTF-8/en_CA.UTF-8/en_CA.UTF-8/C/en_CA.UTF-8/en_CA.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] gapminder_0.3.0 here_1.0.1      report_0.2.0    forcats_0.5.1  
##  [5] stringr_1.4.0   dplyr_1.0.4     purrr_0.3.4     readr_1.4.0    
##  [9] tidyr_1.1.2     tibble_3.1.0    ggplot2_3.3.3   tidyverse_1.3.0
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.6         lubridate_1.7.10   assertthat_0.2.1   rprojroot_2.0.2   
##  [5] digest_0.6.27      utf8_1.1.4         R6_2.5.0           cellranger_1.1.0  
##  [9] backports_1.2.1    reprex_1.0.0       evaluate_0.14      highr_0.8         
## [13] httr_1.4.2         pillar_1.5.0       rlang_0.4.10       readxl_1.3.1      
## [17] rstudioapi_0.13    jquerylib_0.1.3    R.utils_2.10.1     R.oo_1.24.0       
## [21] effectsize_0.4.3-1 styler_1.3.2       rmarkdown_2.7      labeling_0.4.2    
## [25] munsell_0.5.0      broom_0.7.5        compiler_4.0.3     modelr_0.1.8      
## [29] xfun_0.21          pkgconfig_2.0.3    parameters_0.12.0  htmltools_0.5.1.1 
## [33] downlit_0.2.1      insight_0.13.1     tidyselect_1.1.0   bookdown_0.21.6   
## [37] fansi_0.4.2        crayon_1.4.1       dbplyr_2.1.0       withr_2.4.1       
## [41] R.methodsS3_1.8.1  grid_4.0.3         jsonlite_1.7.2     gtable_0.3.0      
## [45] lifecycle_1.0.0    DBI_1.1.1          magrittr_2.0.1     bayestestR_0.8.2.1
## [49] scales_1.1.1       cli_2.3.1          stringi_1.5.3      farver_2.0.3      
## [53] fs_1.5.0           xml2_1.3.2         bslib_0.2.4        ellipsis_0.3.1    
## [57] generics_0.1.0     vctrs_0.3.6        tools_4.0.3        R.cache_0.14.0    
## [61] glue_1.4.2         hms_1.0.0          yaml_2.2.1         colorspace_2.0-0  
## [65] rvest_0.3.6        knitr_1.31         haven_2.3.1        sass_0.3.1</code></pre>
<p>If you want to produce bibliographic citations for your packages you can use the <code>report</code> package:</p>
<div class="sourceCode" id="cb236"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">report</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/report/reference/report.sessionInfo.html">cite_packages</a></span><span class="op">(</span><span class="op">)</span>  </code></pre></div>
<pre><code>##   - H. Wickham. ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York, 2016.
##   - Hadley Wickham (2019). stringr: Simple, Consistent Wrappers for Common String Operations. R package version 1.4.0. https://CRAN.R-project.org/package=stringr
##   - Hadley Wickham (2020). tidyr: Tidy Messy Data. R package version 1.1.2. https://CRAN.R-project.org/package=tidyr
##   - Hadley Wickham (2021). forcats: Tools for Working with Categorical Variables (Factors). R package version 0.5.1. https://CRAN.R-project.org/package=forcats
##   - Hadley Wickham and Jim Hester (2020). readr: Read Rectangular Text Data. R package version 1.4.0. https://CRAN.R-project.org/package=readr
##   - Hadley Wickham, Romain François, Lionel Henry and Kirill Müller (2021). dplyr: A Grammar of Data Manipulation. R package version 1.0.4. https://CRAN.R-project.org/package=dplyr
##   - Jennifer Bryan (2017). gapminder: Data from Gapminder. R package version 0.3.0. https://CRAN.R-project.org/package=gapminder
##   - Kirill Müller (2020). here: A Simpler Way to Find Your Files. R package version 1.0.1. https://CRAN.R-project.org/package=here
##   - Kirill Müller and Hadley Wickham (2021). tibble: Simple Data Frames. R package version 3.1.0. https://CRAN.R-project.org/package=tibble
##   - Lionel Henry and Hadley Wickham (2020). purrr: Functional Programming Tools. R package version 0.3.4. https://CRAN.R-project.org/package=purrr
##   - Makowski, D., Lüdecke, D., &amp; Ben-Shachar, M.S. (2020). Automated reporting as a practical tool to improve reproducibility and methodological best practices adoption. CRAN. Available from https://github.com/easystats/report. doi: .
##   - R Core Team (2020). R: A language and environment for statistical computing. R Foundation for Statistical Computing, Vienna, Austria. URL https://www.R-project.org/.
##   - Wickham et al., (2019). Welcome to the tidyverse. Journal of Open Source Software, 4(43), 1686, https://doi.org/10.21105/joss.01686</code></pre>
<div class="sourceCode" id="cb238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># See also report::report(sessionInfo())</span></code></pre></div>
<p>To absolutely guarantee you can use R code in the future, some applications will benefit from you keeping copies of all the required packages on your own computer system. The <a href="https://rstudio.github.io/packrat/">packrat</a> and <a href="https://github.com/RevolutionAnalytics/checkpoint">checkpoint</a> packages can help you manage packages. I have never felt the need to have this level of reproducibility, but I find it reassuring to know these tools exist.</p>
</div>
<div id="using-other-languages-with-r-markdown" class="section level2" number="20.7">
<h2>
<span class="header-section-number">20.7</span> Using other languages with R markdown<a class="anchor" aria-label="anchor" href="#using-other-languages-with-r-markdown"><i class="fas fa-link"></i></a>
</h2>
<p>R markdown is primarily designed to work with R, but there are many other software tools that are commonly combined with R. These specific tools are outside the goals of this course, but it is valuable to learn about connections between R, R markdown and other computer tools.</p>
<p>In data science, many people work with the <a href="https://www.python.org/">python</a> programming language. Python works with R markdown much the same way as R. Instead of starting a code chunk with <code>{r}</code>, begin with <code>{python}</code>. Here’s an example</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb239-1"><a href="reproduce.html#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb239-2"><a href="reproduce.html#cb239-2" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">8678309</span>)  <span class="co"># Set a random seed to make the work reproducible</span></span>
<span id="cb239-3"><a href="reproduce.html#cb239-3" aria-hidden="true" tabindex="-1"></a>[ random.random() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>) ]</span></code></pre></div>
<pre><code>## [0.3384735123832189, 0.9944778375442942, 0.27482639950589893, 0.8162715855993294, 0.1201299523948246, 0.6565046831819024, 0.36766801924268533, 0.02960201494828596, 0.1228032738500725, 0.7724028393148923]</code></pre>
<p>This example requires the R package <code>reticulate</code> and a working python interpreter that R can find.</p>
<p>You can use the language <a href="https://julialang.org/">julia</a> in R markdown as well if you have the R package <code>JuliaCall</code> and julia installed on your computer.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb241-1"><a href="reproduce.html#cb241-1" aria-hidden="true" tabindex="-1"></a>f(x) <span class="op">=</span> x <span class="op">^</span> <span class="fl">2</span></span></code></pre></div>
<pre><code>## f (generic function with 1 method)</code></pre>
<div class="sourceCode" id="cb243"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb243-1"><a href="reproduce.html#cb243-1" aria-hidden="true" tabindex="-1"></a>f.(<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>)</span></code></pre></div>
<pre><code>## 5-element Array{Int64,1}:
##   1
##   4
##   9
##  16
##  25</code></pre>
<p>Both of these langauges have excellent tools for using them directly and can they can be directly connected to R functions, but this method is available in R markdown. Related to the topic of interoperation of computing langauges, but departing from the topic of R markdown, you can also write C++ code in an R session and execute the compiled code directly from R.</p>
<p><a href="https://en.wikipedia.org/wiki/SQL">SQL</a> is a language for describing queries to a widely used style of database. R contains tools for interacting with SQL databases, but it can aslo generate SQL code from <code>dplyr</code> functions.</p>
<div class="sourceCode" id="cb245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dbplyr.tidyverse.org/">dbplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rsqlite.r-dbi.org">RSQLite</a></span><span class="op">)</span>
<span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html">SQLite</a></span><span class="op">(</span><span class="op">)</span>, dbname <span class="op">=</span> <span class="st">":memory:"</span><span class="op">)</span>
<span class="fu">copy_to</span><span class="op">(</span><span class="va">con</span>, <span class="fu">palmerpenguins</span><span class="fu">::</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html">penguins</a></span>, <span class="st">"penguins"</span><span class="op">)</span>
<span class="va">penguins</span> <span class="op">&lt;-</span> <span class="fu">tbl</span><span class="op">(</span><span class="va">con</span>, <span class="st">"penguins"</span><span class="op">)</span>
<span class="va">penguins_aggr</span> <span class="op">&lt;-</span>
  <span class="va">penguins</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarize</span><span class="op">(</span>
    N <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,
    <span class="fu">across</span><span class="op">(</span><span class="fu">ends_with</span><span class="op">(</span><span class="st">"mm"</span><span class="op">)</span>, <span class="va">sum</span>, .names <span class="op">=</span> <span class="st">"TOT_{.col}"</span><span class="op">)</span>,
    <span class="fu">across</span><span class="op">(</span><span class="fu">ends_with</span><span class="op">(</span><span class="st">"mm"</span><span class="op">)</span>, <span class="va">var</span>, .names <span class="op">=</span> <span class="st">"VAR_{.col}"</span><span class="op">)</span>,
    <span class="fu">across</span><span class="op">(</span><span class="fu">ends_with</span><span class="op">(</span><span class="st">"mm"</span><span class="op">)</span>, <span class="va">mean</span>, .names <span class="op">=</span> <span class="st">"AVG_{.col}"</span><span class="op">)</span>,
  <span class="op">)</span>
<span class="va">penguins_aggr</span></code></pre></div>
<pre><code>## # Source:   lazy query [?? x 11]
## # Database: sqlite 3.34.1 [:memory:]
##   species       N TOT_bill_length_mm TOT_bill_depth_mm TOT_flipper_length_mm
##   &lt;chr&gt;     &lt;int&gt;              &lt;dbl&gt;             &lt;dbl&gt;                 &lt;int&gt;
## 1 Adelie      152              5858.             2770.                 28683
## 2 Chinstrap    68              3321.             1253.                 13316
## 3 Gentoo      124              5843.             1843.                 26714
## # … with 6 more variables: VAR_bill_length_mm &lt;dbl&gt;, VAR_bill_depth_mm &lt;dbl&gt;,
## #   VAR_flipper_length_mm &lt;dbl&gt;, AVG_bill_length_mm &lt;dbl&gt;,
## #   AVG_bill_depth_mm &lt;dbl&gt;, AVG_flipper_length_mm &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb247"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html">capture.output</a></span><span class="op">(</span><span class="fu">show_query</span><span class="op">(</span><span class="va">penguins_aggr</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "&lt;SQL&gt;"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
## [2] "SELECT `species`, COUNT(*) AS `N`, SUM(`bill_length_mm`) AS `TOT_bill_length_mm`, SUM(`bill_depth_mm`) AS `TOT_bill_depth_mm`, SUM(`flipper_length_mm`) AS `TOT_flipper_length_mm`, VARIANCE(`bill_length_mm`) AS `VAR_bill_length_mm`, VARIANCE(`bill_depth_mm`) AS `VAR_bill_depth_mm`, VARIANCE(`flipper_length_mm`) AS `VAR_flipper_length_mm`, AVG(`bill_length_mm`) AS `AVG_bill_length_mm`, AVG(`bill_depth_mm`) AS `AVG_bill_depth_mm`, AVG(`flipper_length_mm`) AS `AVG_flipper_length_mm`"
## [3] "FROM `penguins`"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
## [4] "GROUP BY `species`"</code></pre>
<div class="sourceCode" id="cb249"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></code></pre></div>
<p>What does using other tools have to do with making your work reproducible? R markdown is a flexible tool that lets you use more than just R, so if your workflow contains steps external to R, they can sometimes still be included in your report.</p>
</div>
<div id="further-reading-14" class="section level2" number="20.8">
<h2>
<span class="header-section-number">20.8</span> Further reading<a class="anchor" aria-label="anchor" href="#further-reading-14"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>
<a href="https://r4ds.had.co.nz/workflow-projects.html">Project workflow</a> from R4DS</li>
<li><a href="https://emilyriederer.netlify.app/post/sql-generation/">Generating SQL with dbplyr</a></li>
<li>Peng. Reproducible research in computatonal science. <a href="https://doi.org/10.1126/science.1213847">10.1126/science.1213847</a>
</li>
<li>LeVeque et al. <a href="https://web.stanford.edu/~vcs/papers/CiSE2012-LMS.pdf">Reproducible research for scientific computing</a>
</li>
<li>Sandve et al. Ten simple rules for reproducible computational research. <a href="https://doi.org/10.1371/journal.pcbi.1003285">10.1371/journal.pcbi.1003285</a>
</li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="data-sources.html"><span class="header-section-number">19</span> Finding and accessing data</a></div>
<div class="next"><a href="pca.html"><span class="header-section-number">21</span> Principal component analysis</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#reproduce"><span class="header-section-number">20</span> Reproducible reports</a></li>
<li><a class="nav-link" href="#what-is-reproducibility-and-why-should-i-care"><span class="header-section-number">20.1</span> What is reproducibility and why should I care?</a></li>
<li>
<a class="nav-link" href="#what-are-barriers-to-reproducibility-and-how-i-can-overcome-them"><span class="header-section-number">20.2</span> What are barriers to reproducibility and how I can overcome them?</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#file-paths"><span class="header-section-number">20.2.1</span> File paths</a></li>
<li><a class="nav-link" href="#caching-time-consuming-computations"><span class="header-section-number">20.2.2</span> Caching time-consuming computations</a></li>
<li><a class="nav-link" href="#finding-and-installing-r-packages"><span class="header-section-number">20.2.3</span> Finding and installing R packages</a></li>
</ul>
</li>
<li><a class="nav-link" href="#make-your-report-look-good"><span class="header-section-number">20.3</span> Make your report look good</a></li>
<li><a class="nav-link" href="#code-formatting"><span class="header-section-number">20.4</span> Code formatting</a></li>
<li><a class="nav-link" href="#customization-of-result-reporting-in-r-markdown"><span class="header-section-number">20.5</span> Customization of result reporting in R markdown</a></li>
<li><a class="nav-link" href="#documenting-which-packages-you-use"><span class="header-section-number">20.6</span> Documenting which packages you use</a></li>
<li><a class="nav-link" href="#using-other-languages-with-r-markdown"><span class="header-section-number">20.7</span> Using other languages with R markdown</a></li>
<li><a class="nav-link" href="#further-reading-14"><span class="header-section-number">20.8</span> Further reading</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/AndrewIrwin/data-visualization/blob/master/133-reproducible-reports.rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/AndrewIrwin/data-visualization/edit/master/133-reproducible-reports.rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Visualization</strong>" was written by Andrew Irwin. It was last built on 2021-03-04.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
