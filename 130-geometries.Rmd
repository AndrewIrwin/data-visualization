# Plot geometries

```{r include=FALSE}
library(tidyverse)
library(palmerpenguins)
library(patchwork)
library(ggridges)
library(hexbin)
my_theme <- theme_bw() + theme(text=element_text(size=14))
```

There is an important relationship between the data available to you and the best way to visualize the data. The key factors are

* the types of variables: cateogorical and quantitative
* the number of variables (one or two of one type, more than two of one type, both types)
* the number of observations (a few, many, or a huge number)

Other features are important too -- how many levels of a categorical variable, the distribution of a quantitative variable. That's not our focus here -- look for explorations of those aspects in other lessons.

It's helpful to have a checklist of useful plot geometries for different kinds of data. Wilke's [directory of visualizations](https://clauswilke.com/dataviz/directory-of-visualizations.html) provides an overview of many commonly used types. Here we demonstrate how to use `ggplot` to draw many of these types

We use the `palmerpenguins` data as it 3 categorical variables and 4 quantitative variables. (I'm treating Year as categorical, but you could interpret as quantitative.) I'll keep these plots as simple as possible, with two exceptions. I'll define a theme to control some elements of the layout and I'll use `patchwork` to display multiple plots compactly. See XXX for more on these packages.


## One categorical variable

Bar chart, with bars drawn vertically or horizontally.

```{r}
p1 <- penguins %>% ggplot(aes(x = species)) + geom_bar() + my_theme
p2 <- penguins %>% ggplot(aes(y = island)) + geom_bar() + my_theme
p1 + p2
```


## Multiple categorical variables

With two categories (species and island), you can use colours for one and the x-axis for the other. The variable used for colour can be shown as total counts divided into cateogries by stacking (panel A), by stacked proportions (B), or by side-by-side bars (C). Choose the layout that best highlights the point you want to make. For these data the side-by-side bars the number of ilands each species is found on is different, making the plot a bit awkward.

```{r}
p1 <- penguins %>% ggplot(aes(x = species, fill=island)) + geom_bar() + my_theme
p2 <- penguins %>% ggplot(aes(x = species, fill=island)) + geom_bar(position="fill") + my_theme
p3 <- penguins %>% ggplot(aes(x = species, fill=island)) + geom_bar(position=position_dodge2(preserve="single")) + my_theme 
p1 + p2 + p3 + guide_area() + plot_layout(nrow=2, ncol=2, guides = "collect") + plot_annotation(tag_levels = "A")
```

## One quantitative variable

With one quantitative variable, it's often desirable to show the distribution of the variable. The three standard ways are using boxplots (A), histograms (B), or smooth densities (C). You can show multiples of each of these using a categorical variable mapped on to the y-axis or fill colour. Histograms are drawn as stacked bars but densities overlap, which the transparency (`alpha=0.5`) shows clearly.


```{r warning=FALSE}
p1 <- penguins %>% ggplot(aes(x = body_mass_g, y = sex)) + geom_boxplot() + my_theme
p2 <- penguins %>% ggplot(aes(x = body_mass_g, y = sex, color=species)) + geom_boxplot() + my_theme
p3 <- penguins %>% ggplot(aes(x = body_mass_g, y = sex)) + geom_boxplot() + 
  geom_jitter(aes(color=species), height=0.25, alpha = 0.5) + my_theme
p4 <- penguins %>% ggplot(aes(x = body_mass_g, y = sex, color=species)) + geom_boxplot() + 
  geom_jitter(height=0.25, alpha = 0.5) + my_theme
p1 + p2 + p3 + p4 + plot_layout(ncol=2, nrow=2)
```

```{r}
p2 <- penguins %>% ggplot(aes(x = body_mass_g, fill = sex)) + geom_histogram(bins=20) + my_theme
p3 <- penguins %>% ggplot(aes(x = body_mass_g, fill= sex)) + geom_density(alpha=0.5) + my_theme
p4 <- penguins %>% ggplot(aes(x = body_mass_g, y= sex)) + geom_density_ridges(alpha=0.5) + my_theme
p2 + p3 + p4 + plot_layout(nrow=2, ncol=2, guides = "collect")  + guide_area() + plot_annotation(tag_levels = "A")
```





## Multiple quantitative variables

Scatterplot
Two-d histogram (boxes, hexes)

Missing data are not shown in a scatterplot. This is necessary for data mapped to the x or y axis, unless you want to show the missing data ot a particular value like the mean or 0. For shapes and colors, the points will be not shown unless you convert NA into a text label, such as "missing", when those data are shown as another level of the categorical variable.

```{r}
penguins %>%
  mutate(sex = as.character(sex)) %>%
  replace_na(list(sex = "missing")) %>%
  ggplot(aes(x=bill_length_mm, y= bill_depth_mm, color=species, shape=sex)) + geom_point() + my_theme
```

If there are a lot of data, the points overlap a lot and the patterns can be hard to see. This dataset has a moderate density of points, but we can use the two-dimensional histograms as a demonstration plot.

```{r}
p1 <- penguins %>%  ggplot(aes(x=bill_length_mm, y= bill_depth_mm)) + geom_bin2d() + scale_fill_gradient(limits=c(0,6)) + my_theme
p2 <- penguins %>%  ggplot(aes(x=bill_length_mm, y= bill_depth_mm)) + geom_hex() + scale_fill_gradient(limits=c(0,6)) + my_theme
p1 + p2 + plot_layout(guides="collect")

```

Later: dimension reduction (PCA, NMDS)

## Combinations of quantitative and categorical variables

Heatmaps


```{r}
penguins %>% na.omit() %>% ggplot(aes(x=species, y = sex, fill = body_mass_g)) + geom_tile() + my_theme

```

Later: Facetting


## Resources

* Directory of Visualizations in [Wilke Chapter 5](https://clauswilke.com/dataviz/directory-of-visualizations.html)
* The R [Graph Gallery](https://www.r-graph-gallery.com/index.html)
